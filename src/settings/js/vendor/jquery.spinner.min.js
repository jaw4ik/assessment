(function (n) { "use strict"; var r, i = function (t, r) { this.$el = t; this.options = n.extend({}, i.rules.defaults, i.rules[r.rule] || {}, r || {}); this.min = parseFloat(this.options.min) || 0; this.max = parseFloat(this.options.max) || 0; this.$el.on("focus.spinner", n.proxy(function (t) { t.preventDefault(); n(document).trigger("mouseup.spinner"); this.oldValue = this.value() }, this)).on("change.spinner", n.proxy(function (n) { n.preventDefault(); this.value(this.$el.val()) }, this)).on("keydown.spinner", n.proxy(function (n) { var t = { 38: "up", 40: "down" }[n.which]; t && (n.preventDefault(), this.spin(t)) }, this)); return this.oldValue = this.value(), this.value(this.$el.val()), this }, t; i.rules = { defaults: { min: null, max: null, step: 1, precision: 0 }, currency: { min: 0, max: null, step: .01, precision: 2 }, quantity: { min: 1, max: 999, step: 1, precision: 0 }, percent: { min: 1, max: 100, step: 1, precision: 0 }, month: { min: 1, max: 12, step: 1, precision: 0 }, day: { min: 1, max: 31, step: 1, precision: 0 }, hour: { min: 0, max: 23, step: 1, precision: 0 }, minute: { min: 1, max: 59, step: 1, precision: 0 }, second: { min: 1, max: 59, step: 1, precision: 0 } }; i.prototype = { spin: function (n) { if (this.$el.attr("disabled") !== "disabled") { this.oldValue = this.value(); switch (n) { case "up": this.value(this.oldValue + Number(this.options.step, 10)); break; case "down": this.value(this.oldValue - Number(this.options.step, 10)) } } }, value: function (i) { if (i === null || i === undefined) return this.numeric(this.$el.val()); i = this.numeric(i); var u = this.validate(i); u !== 0 && (i = u === -1 ? this.min : this.max); this.$el.val(i.toFixed(this.options.precision)); this.oldValue !== this.value() && (this.$el.trigger("changing.spinner", [this.value(), this.oldValue]), clearTimeout(r), r = setTimeout(n.proxy(function () { this.$el.trigger("changed.spinner", [this.value(), this.oldValue]) }, this), t.delay)) }, numeric: function (n) { return n = this.options.precision > 0 ? parseFloat(n, 10) : parseInt(n, 10), n || this.options.min || 0 }, validate: function (n) { return this.options.min !== null && n < this.min ? -1 : this.options.max !== null && n > this.max ? 1 : 0 } }; t = function (t, r) { this.$el = t; this.$spinning = n("[data-spin='spinner']", this.$el); this.$spinning.length === 0 && (this.$spinning = n(":input[type='text']", this.$el)); this.spinning = new i(this.$spinning, this.$spinning.data()); this.$el.on("click.spinner", "[data-spin='up'],[data-spin='down']", n.proxy(this.spin, this)).on("mousedown.spinner", "[data-spin='up'],[data-spin='down']", n.proxy(this.spin, this)); n(document).on("mouseup.spinner", n.proxy(function () { clearTimeout(this.spinTimeout); clearInterval(this.spinInterval) }, this)); r = n.extend({}, r); r.delay && this.delay(r.delay); r.changed && this.changed(r.changed); r.changing && this.changing(r.changing) }; t.delay = 500; t.prototype = { constructor: t, spin: function (t) { var i = n(t.currentTarget).data("spin"); switch (t.type) { case "click": t.preventDefault(); this.spinning.spin(i); break; case "mousedown": t.which === 1 && (this.spinTimeout = setTimeout(n.proxy(this.beginSpin, this, i), 300)) } }, delay: function (n) { var t = parseInt(n, 10); t > 0 && (this.constructor.delay = t + 100) }, value: function () { return this.spinning.value() }, changed: function (n) { this.bindHandler("changed.spinner", n) }, changing: function (n) { this.bindHandler("changing.spinner", n) }, bindHandler: function (t, i) { if (n.isFunction(i)) this.$spinning.on(t, i); else this.$spinning.off(t) }, beginSpin: function (t) { this.spinInterval = setInterval(n.proxy(this.spinning.spin, this.spinning, t), 100) } }; n.fn.spinner = function (i, r) { return this.each(function () { var u = n(this), f = u.data("spinner"); f || u.data("spinner", f = new t(u, n.extend({}, u.data(), i))); (i === "delay" || i === "changed" || i === "changing") && f[i](r); i === "spin" && r && f.spinning.spin(r) }) }; n(function () { n('[data-trigger="spinner"]').spinner() }) })(jQuery);