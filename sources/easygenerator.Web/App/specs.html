<!DOCTYPE html>
<html>
<head>
    <title>Jasmine Spec Runner</title>

    <link rel="stylesheet" type="text/css" href="../Content/jasmine.css">

    <script type="text/javascript" src="../Scripts/jasmine-1.3.1.js"></script>
    <script type="text/javascript" src="../Scripts/jasmine-1.3.1-html.js"></script>
    <script type="text/javascript" src="../Scripts/jasmine-1.3.1-console.js"></script>

    <!-- include source files here... -->
    <script type="text/javascript" src="../Scripts/jquery-2.0.3.js"></script>
    <script type="text/javascript" src="../Scripts/knockout-2.3.0.debug.js"></script>
    <script type="text/javascript" src="../Scripts/knockout.validation.debug.js"></script>
    <script type="text/javascript" src="../Scripts/sammy-0.7.4.js"></script>
    <script type="text/javascript" src="../Scripts/q.js"></script>
    <script type="text/javascript" src="../Scripts/underscore.js"></script>
    <script type="text/javascript" src="../Scripts/underscore.extensions.js"></script>

    <script type="text/javascript" src="durandal/amd/require.js"></script>

    <script type="text/javascript">

        (function () {
            require.config({
                paths: {
                    "text": "durandal/amd/text"
                },
                urlArgs: 'v=' + Math.random()
            });

            var specs = [
                'localization/localizationManager.spec',
                'repositories/objectiveBriefRepository.spec',
                'viewmodels/objectives/objectives.spec',
                'viewmodels/objectives/objective.spec',
                //'viewmodels/objectives/createObjective.spec',
                'viewmodels/questions/question.spec',
                'viewmodels/experiences/experiences.spec'
            ];

            require(specs, function () {
                var jasmineEnv = jasmine.getEnv();
                jasmineEnv.updateInterval = 1000;

                var htmlReporter = new jasmine.HtmlReporter();
                var consoleReporter = new jasmine.ConsoleReporter();

                jasmineEnv.addReporter(htmlReporter);
                jasmineEnv.addReporter(consoleReporter);

                jasmineEnv.specFilter = function (spec) {
                    return htmlReporter.specFilter(spec);
                };

                jasmine.DEFAULT_TIMEOUT_INTERVAL = 100;

                jasmineEnv.execute();


                beforeEach(function () {
                    var matchers = {
                        toBeSortedAsc: function (sortingField) {
                            return toBeSorted(sortingField, this.actual, true);
                        },

                        toBeSortedDesc: function (sortingField) {
                            return toBeSorted(sortingField, this.actual, false);
                        }
                    };

                    this.addMatchers(matchers);
                });

                function toBeSorted(sortingField, asc, actual) {
                    if (this.isNot) {
                        throw '[.not] is not supported';
                    }

                    if (_.isEmpty(sortingField)) {
                        throw 'You should specify sorting field';
                    }

                    this.message = function () {
                        if (asc)
                            return "Expected " + JSON.stringify(this.actual) + " to be sorted ascending by '" + sortingField + "'";

                        return "Expected " + JSON.stringify(this.actual) + " to be sorted descending by '" + sortingField + "'";
                    };

                    var arr = actual;
                    for (var i = 0, len = arr.length; i < len - 1; i++) {
                        var value1 = arr[i][sortingField];
                        var value2 = arr[i + 1][sortingField];

                        if (ko.isObservable(value1)) {
                            value1 = value1();
                            value2 = value2();
                        }

                        if (asc) {
                            if (value1.toLowerCase() > value2.toLowerCase()) return false;
                        } else if (value1.toLowerCase() < value2.toLowerCase()) return false;
                    }
                    return true;
                }

            });
        })();

    </script>

</head>

<body>
</body>
</html>
