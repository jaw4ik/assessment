@using System.Configuration
@using easygenerator.Web.Components.Configuration

@if(!String.IsNullOrEmpty((ConfigurationManager.GetSection("intercom") as IntercomConfigurationSection).AppId) && !String.IsNullOrEmpty((ConfigurationManager.GetSection("intercom") as IntercomConfigurationSection).ApiKey))
{
    <script type="text/javascript">
        (function () {
            var w = window;
            var ic = w.Intercom;

            if (typeof ic === "function") {
                ic('reattach_activator');
                ic('update', intercomSettings);
            } else {
                var d = document;
                var i = function () { i.c(arguments) };
                i.q = [];
                i.c = function (args) { i.q.push(args) };
                w.Intercom = i;

                function l() {
                    var s = d.createElement('script');
                    s.type = 'text/javascript';
                    s.async = true;
                    s.src = 'https://widget.intercom.io/widget/@((ConfigurationManager.GetSection("intercom") as IntercomConfigurationSection).AppId)';
                    var x = d.getElementsByTagName('script')[0];
                    x.parentNode.insertBefore(s, x);
                }

                if (w.attachEvent) {
                    w.attachEvent('onload', l);
                } else {
                    w.addEventListener('load', l, false);
                }
            }

            Intercom('onShow', function () {
                if (HS && HS.beacon && HS.beacon.close) {
                    HS.beacon.close();
                }
            });
        })();
        window.analytics = { intercomapp_id: '@((ConfigurationManager.GetSection("intercom") as IntercomConfigurationSection).AppId)' };
    </script>
}
