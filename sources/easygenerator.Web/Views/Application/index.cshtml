@using System.Configuration
@using System.Threading
@using System.Web.Optimization
@using easygenerator.Infrastructure
@using easygenerator.Web.Components

@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=640,maximum-scale=1.0">
    <meta name="description" content="">
    <title>easygenerator</title>

    @Styles.Render("~/Content/css")
    @Html.Partial("_mixpanelAnalytics")
    @Html.Partial("_nudgespotAnalytics")
</head>
<body>
    @if (BrowserSupport.IsSupportedDevice(HttpContext.Current.Request.UserAgent))
    {
        if (BrowserSupport.IsFullySupportedBrowser(HttpContext.Current.Request.UserAgent, HttpContext.Current.Request.Browser) || BrowserSupport.IsPartiallySupportedBrowser(HttpContext.Current.Request.UserAgent, HttpContext.Current.Request.Browser))
        {
            <div id="app" class="application">
                <div class="circular-loader x32 black align-center">
                    <div class="circular-loader-item"></div>
                    <div class="circular-loader-item"></div>
                    <div class="circular-loader-item"></div>
                    <div class="circular-loader-item"></div>
                    <div class="circular-loader-item"></div>
                    <div class="circular-loader-item"></div>
                    <div class="circular-loader-item"></div>
                    <div class="circular-loader-item"></div>
                </div>
            </div>
        }

        if (!BrowserSupport.IsFullySupportedBrowser(HttpContext.Current.Request.UserAgent, HttpContext.Current.Request.Browser))
        {
            @Html.Partial("notSupportedPage")
        }
    }
    else
    {
        @Html.Partial("notSupportedDevicePage")
    }

    @Scripts.Render("~/scripts/vendor")
    <script src="signalr/hubs"></script>

    <script type="text/javascript">
        var CKEDITOR_BASEPATH = '/Scripts/ckeditor/';
    </script>
    @Scripts.Render("~/scripts/ckeditor.min")
    <script type="text/javascript">
        CKEDITOR.timestamp = @DateTimeWrapper.InstanceStartTime.Ticks;
    </script>

    @if (Request.UserLanguages != null && Request.UserLanguages.Length > 0)
    {
        var userCultures = Request.UserLanguages.Select(l => l.Split(';')[0]).ToList();
        <script type="text/javascript">

            window.userCultures = [];
            window.appVersion = @DateTimeWrapper.InstanceStartTime.Ticks;
            window.BOMSymbol = '\ufeff';

            @for (var i = 0; i < userCultures.Count(); i++)
            {
                <text>window.userCultures.push('@userCultures[i]');</text>;
            }
        </script>
    }

    <script type="text/javascript">
        @if (!String.IsNullOrEmpty(ConfigurationManager.AppSettings["StorageServiceUrl"]))
        {
            <text>
            window.storageServiceUrl = '@ConfigurationManager.AppSettings["StorageServiceUrl"]';
            </text>
        }
        @if (!String.IsNullOrEmpty(ConfigurationManager.AppSettings["ConvertionServiceUrl"]))
        {
            <text>
            window.convertionServiceUrl = '@ConfigurationManager.AppSettings["ConvertionServiceUrl"]';
            </text>
        }

        //bootstraper
        (function() {
            if (window.auth.isUserLoggedIn() || window.auth.isAuthTokenPresentInHash()) {
                System.baseURL = '/app';

                var systemLoadPromise = System.import('system-config.js');

                @if (!HttpContext.Current.IsDebuggingEnabled)
                {
                    <text>
                    systemLoadPromise = systemLoadPromise.then(function () {
                        return System.import('main-built.js');
                    });
                    </text>
                }

                systemLoadPromise.then(function () {
                    return System.import('index.js');
                });
            }
            else {
                window.location.replace('/signin');
            }
        }());

    </script>

</body>

</html>
