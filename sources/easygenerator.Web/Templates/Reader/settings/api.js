!function(){function e(){var e=$.ajax({url:T,headers:v,cache:!1,type:"POST",contentType:"application/json",dataType:"json"}),t=$.ajax({url:j,headers:v,cache:!1,contentType:"application/json",dataType:"json"}),n=$.ajax({url:S,headers:v,cache:!1,contentType:"application/json",dataType:"json"});return $.when(n,e,t).done(function(e,t,n){y.manifest=s(e[0]),y.user=o(t[0]),y.settings=r(n[0]),y.isInited=!0})}function t(){if(!y.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function n(){return t(),y.manifest}function i(){return t(),y.user}function a(){return t(),y.settings}function s(e){if(e&&e.languages&&e.languages.length>0)for(var t=0;t<e.languages.length;t++)e.languages[t].url=w+e.languages[t].url;return e}function o(e){e=e.data;var t={accessType:0},n=1;return e.subscription&&e.subscription.accessType&&e.subscription.accessType>=n&&new Date(e.subscription.expirationDate)>=new Date&&(t.accessType=e.subscription.accessType),t}function r(e){var t;return t=e.settings&&e.settings.length>0?JSON.parse(e.settings):{xApi:{enabled:!0,selectedLrs:"default",lrs:{credentials:{}}},masteryScore:{}}}function c(e){var t=RegExp(e+"=(.+?)(&|$)").exec(location.search)||null;return null===t?null:decodeURI(t[1])}function u(e,t,n,i){l();var a={settings:e,extraSettings:t},s={url:j,type:"POST",headers:v,cache:!1,dataType:"json",data:a};return $.ajax(s).done(function(){g(n,!0)}).fail(function(){g(i,!1)}).always(function(){p()})}function l(){d({type:"freeze-editor"})}function p(){d({type:"unfreeze-editor"})}function g(e,t){d({type:"notification",data:{success:t,message:e}})}function f(){d({type:"show-settings"})}function d(e){var t=window.parent;t.postMessage(e,"*")}var y={isInited:!1},h=location.protocol+"//"+location.host,T=h+"/auth/identity",j=h+"/api/course/"+c("courseId")+"/template/"+c("templateId"),w=location.toString().substring(0,location.toString().indexOf("/settings/"))+"/",S=w+"manifest.json",v={Authorization:"Bearer "+(c("token")||localStorage["token.settings"])};window.egApi={init:e,getManifest:n,getUser:i,getSettings:a,saveSettings:u,sendNotificationToEditor:g,showSettings:f}}();