!function(){function t(){var t=$.ajax({url:T,cache:!1,type:"POST",contentType:"application/json",dataType:"json"}),n=$.ajax({url:h,cache:!1,contentType:"application/json",dataType:"json"}),e=$.ajax({url:w,cache:!1,contentType:"application/json",dataType:"json"});return $.when(e,t,n).done(function(t,n,e){d.manifest=s(t[0]),d.user=a(n[0]),d.settings=c(e[0]),d.isInited=!0})}function n(){if(!d.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function e(){return n(),d.manifest}function i(){return n(),d.user}function o(){return n(),d.settings}function s(t){if(t&&t.languages&&t.languages.length>0)for(var n=0;n<t.languages.length;n++)t.languages[n].url=j+t.languages[n].url;return t}function a(t){var n={accessType:0},e=1;return t.subscription&&t.subscription.accessType&&t.subscription.accessType>=e&&new Date(t.subscription.expirationDate)>=new Date&&(n.accessType=t.subscription.accessType),n}function c(t){var n;return n=t.settings&&t.settings.length>0?JSON.parse(t.settings):{logo:{}}}function r(t){return decodeURI((RegExp(t+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}function u(t,n,e,i){return p(),$.post(h,{settings:t,extraSettings:n}).done(function(){l(e,!0)}).fail(function(){l(i,!1)}).always(function(){f()})}function p(){g({type:"freeze",data:{freezeEditor:!0}})}function f(){g({type:"freeze",data:{freezeEditor:!1}})}function g(t){var n=window.top;n.postMessage(t,n.location.href)}function l(t,n){g({type:"notification",data:{success:n||!0,message:t}})}var d={isInited:!1},y=location.protocol+"//"+location.host,T=y+"/api/identify",h=y+"/api/course/"+r("courseId")+"/template/"+r("templateId"),j=location.toString().substring(0,location.toString().indexOf("/settings/settings"))+"/",w=j+"manifest.json";window.egApi={init:t,getManifest:e,getUser:i,getSettings:o,saveSettings:u,sendNotificationToEditor:l}}();