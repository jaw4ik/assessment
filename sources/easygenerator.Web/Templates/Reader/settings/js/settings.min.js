function getURLParameter(n){return decodeURI((RegExp(n+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}function sendPostMessage(n){var t=window.parent;t.postMessage(n,window.location.href)}$(function(){function o(){return{logo:{url:n.hasStarterPlan()?n.logo.url():""}}}function w(){if(!this.files){i.submit();return}if(this.files.length!=0){var n=this.files[0],r=n.name.split(".").pop().toLowerCase();if($.inArray(r,l)===-1){t.fail({title:"Unsupported image format",description:"(Supported formats: "+l.join(", ")+")"});return}if(n.size>c*1048576){t.fail({title:"File is too large",description:"(Max file size: "+c+"MB)"});return}b(n)}}function b(n){i.disable();t.loading();var r=new FormData;r.append("file",n);$.ajax({url:h,type:"POST",data:r,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(n){a(n)}).fail(function(){t.fail(f);i.enable()})}function k(){$("#logoForm").attr("action",h);$("#logoFrame").on("readystatechange",function(){if(this.readyState=="complete")try{var n=this.contentDocument.body.innerHTML;a(n)}catch(r){t.fail(f);i.enable()}})}function a(r){try{if(!r)throw"Response is empty";if(typeof r!="object"&&(r=JSON.parse(r)),!r||!r.success||!r.data)throw"Request is not success";n.logo.url(r.data.url);t.default()}catch(u){t.fail(f)}finally{i.enable()}}var s;ko.bindingHandlers.fadeVisible={init:function(n,t){var i=t();$(n).toggle(ko.unwrap(i))},update:function(n,t){var i=t();ko.unwrap(i)?$(n).fadeIn():$(n).fadeOut()}};var v=getURLParameter("courseId"),y=getURLParameter("templateId"),r=location.protocol+"//"+location.host,e=r+"/api/course/"+v+"/template/"+y,u=null,p=1,n={logo:function(){var n={};return n.url=ko.observable(""),n.hasLogo=ko.computed(function(){return n.url()!=""}),n.clear=function(){n.url("")},n.isError=ko.observable(!1),n.errorText=ko.observable(""),n.errorDescription=ko.observable(""),n.isLoading=ko.observable(!1),n}(),hasStarterPlan:ko.observable(!0)};n.saveChanges=function(){var n=o();JSON.stringify(u)!==JSON.stringify(n)&&(sendPostMessage({type:"startSave"}),$.post(e,{settings:JSON.stringify(n)}).done(function(){u=n;sendPostMessage({type:"finishSave",data:{success:!0,message:"All changes are saved"}})}).fail(function(){sendPostMessage({type:"finishSave",data:{success:!1,message:"Changes have NOT been saved. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists."}})}))};$(window).on("blur",n.saveChanges);s=$.ajax({url:r+"/api/identify",type:"POST",contentType:"application/json",dataType:"json",success:function(t){if(t.hasOwnProperty("subscription")&&t.subscription.hasOwnProperty("accessType")){var i=t.subscription.accessType>=p&&new Date(t.subscription.expirationDate)>=new Date;n.hasStarterPlan(i)}else n.hasStarterPlan(!1)},error:function(){n.hasStarterPlan(!1)}});$.ajax({cache:!1,url:e,dataType:"json",success:function(t){var r={logo:{}},i;try{i=JSON.parse(t.settings)||r}catch(u){i=r}n.logo.url(i.logo.url||"")},complete:function(){s.complete(function(){u=o()})}});ko.applyBindings(n,$("#settingsForm")[0]);var h=r+"/storage/image/upload",c=10,l=["jpeg","jpg","png","bmp","gif"],f={title:"Something went wrong",description:"Please, try again"},t={"default":function(){n.logo.isLoading(!1);n.logo.isError(!1)},fail:function(t){n.logo.clear();n.logo.isLoading(!1);n.logo.errorText(t.title);n.logo.errorDescription(t.description);n.logo.isError(!0)},loading:function(){n.logo.isLoading(!0)}},i={enable:function(){this.$input.attr("disabled",!1).closest(".image-upload-button").removeClass("disabled")},disable:function(){this.$input.attr("disabled",!0).closest(".image-upload-button").addClass("disabled")},submit:function(){this.$input[0].form.submit();this.disable();t.loading()},$input:function(){return $("#logoInput").on("change",w)}()};window.top.navigator.userAgent.match(/MSIE 9/i)&&k()});