!function(e){e.localize=function(e){return n[e]};var n={"changes are saved":"All changes are saved","changes are not saved":"Changes have NOT been saved. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists.","settings are not initialize":"Template settings are not initialized. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists.","graphical customization":"Graphical customization",cartoon:"Cartoon light",grey:"Grey scheme",black:"Black scheme",flat:"Flat scheme","custom course logo":"Custom course logo:",or:"or","upload logo image":"Upload logo image","upgrade account hint":'You have to <a target="_blank" href="/account/upgrade">upgrade your account</a> in order to set custom course logo',"logo update":"Change","logo remove":"Clear","choose color scheme":"Choose color scheme:",scheme:"Scheme:","background change":"Change background:","background update":"Change background","background remove":"Clear background","background default":"Default","background repeat":"Repeat","background fullscreen":"Fullscreen","background upgrade account hint":'You have to <a target="_blank" href="/account/upgrade">upgrade your account</a> in order to set custom course background'}}(window.app=window.app||{}),function(e){function n(e){var n=e.name.split(".").pop().toLowerCase();return-1===$.inArray(n,i.supportedExtensions)?{title:"Unsupported image format",description:"(Allowed formats: "+i.supportedExtensions.join(", ")+")"}:e.size>1024*i.maxFileSize*1024?{title:"File is too large",description:"(Max file size: "+i.maxFileSize+"MB)"}:!0}function t(e){var n=RegExp(e+"=(.+?)(&|$)").exec(location.search)||null;return null===n?null:decodeURI(n[1])}var o=location.protocol+"//"+location.host+"/storage/image/upload",a={Authorization:"Bearer "+(t("token")||localStorage["token.settings"])},r={title:"Something went wrong",description:"Please, try again"},i={maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"]};e.upload=function(e){var t=$.Deferred(),c=$("<form>").hide().attr("method","post").attr("enctype","multipart/form-data").insertAfter("body"),s=$("<input>").attr("accept",i.supportedExtensions.map(function(e){return"."+e}).join(", ")).attr("type","file").attr("name","file").on("change",function(){e&&e();var i=this.files[0],c=n(i);if(c!==!0)return void t.reject(c);var s=new FormData;s.append("file",i),$.ajax({url:o,type:"POST",headers:a,data:s,contentType:!1,processData:!1}).done(function(e){try{var n=JSON.parse(e);n&&n.success&&n.data&&n.data.url?t.resolve(n.data.url):t.reject(r)}catch(o){t.reject(r)}}).fail(function(){t.reject(r)})}).appendTo(c);return s.click(),t.promise()}}(window.app=window.app||{}),function(){ko.bindingHandlers.fadeVisible={init:function(e,n){var t=n();$(e).toggle(ko.unwrap(t))},update:function(e,n){var t=n();ko.unwrap(t)?$(e).fadeIn():$(e).fadeOut()}},ko.bindingHandlers.localize={init:function(e,n){var t=$(e),o=ko.unwrap(n());t.html(app.localize(o))}},ko.bindingHandlers.background={init:function(e){$(e).css("background-size","cover").css("background-position","center").css("background-repeat","no-repeat")},update:function(e,n){var t=ko.unwrap(n());if($(e).css("background-image","none"),t){var o=new Image;o.onload=function(){$(e).css("background-image","url("+t+")")},o.src=t}}}}(),function(e){function n(e){this.hasStarterPlan=e&&e.accessType>0}function t(n){function t(e){e&&u.setUrl(e.url)}function o(){u.isLoading()||e.upload(function(){i()}).done(function(e){c(e),a()}).fail(function(e){r(e.title,e.description)})}function a(){u.isLoading(!1),u.isError(!1)}function r(e,n){u.clear(),u.isLoading(!1),u.isError(!0),u.errorText(e),u.errorDescription(n)}function i(){u.clear(),u.isLoading(!0)}function c(e){u.url(e||"")}function s(){return{url:u.url()}}var u=this;return u.url=ko.observable(""),u.hasLogo=ko.computed(function(){return""!==u.url()}),u.clear=function(){u.url("")},u.isError=ko.observable(!1),u.errorText=ko.observable(""),u.errorDescription=ko.observable(""),u.isLoading=ko.observable(!1),u.setUrl=c,u.getData=s,u.upload=o,t(n),u}function o(e){function n(e){e&&e.key&&c.selectByName(e.key)}function t(e){ko.utils.arrayForEach(c.list,function(e){e.isSelected(!1)}),e.isSelected(!0)}function o(e){ko.utils.arrayForEach(c.list,function(n){n.isSelected(n.name===e)})}function a(){var e=location.toString().indexOf("/settings/"),n=location.toString().substring(0,e),t=["v="+(new Date).getTime(),"theme="+c.selectedThemeName()].join("&");window.open(n+"?"+t,"_blank")}function r(){return{key:c.selectedThemeName()}}function i(e,n){var t=this;return t.name=e,t.isSelected=ko.observable(n===!0),t}var c=this;return c.list=[new i("cartoon",!0),new i("grey"),new i("black"),new i("flat")],c.selectedThemeName=ko.computed(function(){var e="";return ko.utils.arrayForEach(c.list,function(n){n.isSelected()&&(e=n.name)}),e},c),c.select=t,c.selectByName=o,c.openDemo=a,c.getData=r,n(e),c}function a(n){var t=$.extend(!0,{image:{src:null,type:"default"}},n),o=this;o.image=ko.observable(t.image.src),o.image.isUploading=ko.observable(!1),o.image.isEmpty=ko.computed(function(){return!(o.image()&&o.image().length>0)}),o.type=ko.observable(t.image.type),o.type["default"]=function(){o.type("default")},o.type.repeat=function(){o.type("repeat")},o.type.fullscreen=function(){o.type("fullscreen")},o.errorTitle=ko.observable(),o.errorDescription=ko.observable(),o.hasError=ko.observable(!1),o.changeImage=function(){o.image.isUploading()||e.upload(function(){o.image.isUploading(!0),o.hasError(!1),o.errorTitle(void 0),o.errorDescription(void 0)}).done(function(e){o.image(e)}).fail(function(e){o.image(void 0),o.hasError(!0),o.errorTitle(e.title),o.errorDescription(e.description)}).always(function(){o.image.isUploading(!1)})},o.clearImage=function(){o.image(null)},o.getData=function(){return{image:{src:o.image(),type:o.type()}}}}e.UserAccessModel=n,e.LogoModel=t,e.ThemesModel=o,e.BackgroundModel=a}(window.app=window.app||{}),function(e){var n=null,t=null,o={isError:ko.observable(!1),userAccess:null,logo:null,themes:null,background:null};o.getCurrentSettingsData=function(e){return $.extend({},e||n,{logo:o.logo.getData(),theme:o.themes.getData(),background:o.background.getData()})},o.getCurrentExtraData=function(){return{}},o.saveChanges=function(){var a=o.getCurrentSettingsData(),r=o.getCurrentExtraData(),i=JSON.stringify(a),c=JSON.stringify(r);(JSON.stringify(n)!==i||JSON.stringify(t)!==c)&&window.egApi.saveSettings(i,c,e.localize("changes are saved"),e.localize("changes are not saved")).done(function(){n=a,t=r})},o.init=function(){var a=window.egApi;return a.init().then(function(){var r=a.getUser(),i=a.getSettings();o.userAccess=new e.UserAccessModel(r),o.logo=new e.LogoModel(i.logo),o.themes=new e.ThemesModel(i.theme),o.background=new e.BackgroundModel(i.background),n=o.getCurrentSettingsData(i),t=o.getCurrentExtraData()}).fail(function(){o.isError(!0)})},o.init().always(function(){$(document).ready(function(){ko.applyBindings(o,$(".settings-container")[0]),$(window).on("blur",o.saveChanges)})})}(window.app=window.app||{});