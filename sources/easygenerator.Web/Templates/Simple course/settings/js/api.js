!function(){function e(){var e=$.Deferred().resolve([{subscription:{accessType:1,expirationDate:new Date(2016,1,1)}}]),t=$.getJSON("../../settings.js").then(function(e){return[{settings:JSON.stringify(e)}]}),n=$.getJSON(b);return $.when(n,e,t).done(function(e,t,n){d.manifest=o(e[0]),d.user=r(t[0]),d.settings=a(n[0]),d.isInited=!0})}function t(){if(!d.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function n(){return t(),d.manifest}function i(){return t(),d.user}function s(){return t(),d.settings}function o(e){if(e&&e.languages&&e.languages.length>0)for(var t=0;t<e.languages.length;t++)e.languages[t].url=S+e.languages[t].url;return e}function r(e){var t={accessType:0},n=1;return e.subscription&&e.subscription.accessType&&e.subscription.accessType>=n&&new Date(e.subscription.expirationDate)>=new Date&&(t.accessType=e.subscription.accessType),t}function a(e){var t;return t=e.settings&&e.settings.length>0?JSON.parse(e.settings):{logo:{},xApi:{enabled:!0,selectedLrs:"default",lrs:{credentials:{}}},masteryScore:{}}}function c(e){return decodeURI((RegExp(e+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}function u(e,t,n,i){return f(),$.post(w,{settings:e,extraSettings:t}).done(function(){p(n,!0)}).fail(function(){p(i,!1)}).always(function(){g()})}function f(){l({type:"freeze",data:{freezeEditor:!0}})}function g(){l({type:"freeze",data:{freezeEditor:!1}})}function l(e){var t=window.top;t.postMessage(e,t.location.href)}function p(e,t){l({type:"notification",data:{success:t||!0,message:e}})}var d={isInited:!1},y=location.protocol+"//"+location.host,w=y+"/api/course/"+c("courseId")+"/template/"+c("templateId"),S=location.toString().substring(0,location.toString().indexOf("/settings/"))+"/",b=S+"manifest.json";window.egApi={init:e,getManifest:n,getUser:i,getSettings:s,saveSettings:u,sendNotificationToEditor:p}}();