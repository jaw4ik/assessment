!function(){function t(){var t=$.Deferred(),e=window.parent.localStorageProvider;return e||t.resolve(localStorage["token.settings"]),e.getItem("token.settings").then(function(e){t.resolve(e)}).fail(function(){t.resolve("")}),t.promise()}function e(){return t().then(function(t){x.Authorization+=u("token")||t;var e=$.ajax({url:T,headers:x,cache:!1,type:"POST",contentType:"application/json",dataType:"json"}),n=$.ajax({url:w,headers:x,cache:!1,contentType:"application/json",dataType:"json"}),i=$.ajax({url:S,headers:x,cache:!1,contentType:"application/json",dataType:"json"});return $.when(i,e,n).done(function(t,e,n){y.manifest=s(t[0]),y.user=r(e[0]),y.settings=c(n[0]),y.isInited=!0})})}function n(){if(!y.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function i(){return n(),y.manifest}function a(){return n(),y.user}function o(){return n(),y.settings}function s(t){if(t&&t.languages&&t.languages.length>0)for(var e=0;e<t.languages.length;e++)t.languages[e].url=j+t.languages[e].url;return t}function r(t){t=t.data;var e={accessType:0},n=1;return t.subscription&&t.subscription.accessType&&t.subscription.accessType>=n&&new Date(t.subscription.expirationDate)>=new Date&&(e.accessType=t.subscription.accessType),e}function c(t){var e;return e=t.settings&&t.settings.length>0?JSON.parse(t.settings):{}}function u(t){var e=RegExp(t+"=(.+?)(&|$)").exec(location.search)||null;return null===e?null:decodeURI(e[1])}function l(t,e,n,i){p();var a={settings:t,extraSettings:e},o={url:w,type:"POST",headers:x,cache:!1,dataType:"json",data:a};return $.ajax(o).done(function(){g(n,!0)}).fail(function(){g(i,!1)}).always(function(){f()})}function p(){h({type:"freeze-editor"})}function f(){h({type:"unfreeze-editor"})}function g(t,e){h({type:"notification",data:{success:e,message:t}})}function d(){h({type:"show-settings"})}function h(t){var e=window.parent;e.postMessage(t,"*")}var y={isInited:!1},v=location.protocol+"//"+location.host,T=v+"/auth/identity",w=v+"/api/course/"+u("courseId")+"/template/"+u("templateId"),j=location.toString().substring(0,location.toString().indexOf("/settings/"))+"/",S=j+"manifest.json",x={Authorization:"Bearer "};window.egApi={init:e,getManifest:i,getUser:a,getSettings:o,saveSettings:l,sendNotificationToEditor:g,showSettings:d}}();