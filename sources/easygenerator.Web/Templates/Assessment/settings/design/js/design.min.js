!function(){"use strict";function e(e,n,r){function t(){var e=i();angular.equals(a,e)||s.saveSettings(JSON.stringify(e),null).done(function(){a=e})}function i(e){return $.extend({},e||a,{logo:{url:o.logo.url},background:{image:{src:o.background.image.src,type:o.background.type}}})}var o=e,a=null,s=window.egApi;return o.isError=!1,o.background=new function(e){var n=this;n.image={src:null,isUploading:!1,isEmpty:!0},n.type="fullscreen",n.setFullscreen=function(){n.type="fullscreen",e()},n.setRepeat=function(){n.type="repeat",e()},n.setOriginal=function(){n.type="original",e()},n.errorTitle=null,n.errorDescription=null,n.hasError=!1,n.changeImage=function(){n.image.isUploading||r(function(){n.image.isUploading=!0,n.hasError=!1,n.errorTitle=void 0,n.errorDescription=void 0,o.$apply()}).done(function(e){n.image.src=e,n.image.isEmpty=!1}).fail(function(e){n.image.src=null,n.image.isEmpty=!0,n.hasError=!0,n.errorTitle=e.title,n.errorDescription=e.description}).always(function(){n.image.isUploading=!1,e(),o.$apply()})},n.clearImage=function(){n.image.src=null,n.image.isEmpty=!0,e()},n.init=function(e){e&&e.image&&(e.image.src&&(n.image.src=e.image.src,n.image.isEmpty=!1),e.image.type&&(n.type=e.image.type))}}(t),o.userAccess=function(){function e(e){n.hasStarterPlan=e.accessType>0}var n={};return n.hasStarterPlan=!0,n.init=e,n}(),o.logo=function(e){function n(){return""!==l.url}function t(){l.url="",e()}function i(e){l.url="",e&&e.url&&(l.url=e.url)}function a(){l.isLoading||r(function(){s(),o.$apply()}).done(function(e){l.url=e,c()}).fail(function(e){u(e.title,e.description)}).always(function(){e(),o.$apply()})}function s(){l.clear(),l.isLoading=!0}function c(){l.isLoading=!1,l.hasError=!1}function u(e,n){l.clear(),l.isLoading=!1,l.hasError=!0,l.errorText=e,l.errorDescription=n}var l={};return l.url="",l.isLoading=!1,l.hasError=!1,l.errorText="Unsupported image format",l.errorDescription="(Supported formats: jpg, png, bmp)",l.hasLogo=n,l.clear=t,l.upload=a,l.init=i,l}(t),o.saveChanges=t,angular.element(n).on("blur",t),s.init().then(function(){var e=s.getUser(),n=s.getSettings();o.userAccess.init(e),o.logo.init(n.logo),o.background.init(n.background),a=i(n)}).fail(function(){o.isError=!0}).always(function(){o.$applyAsync(),s.showSettings()})}angular.module("design",[]).controller("DesignController",["$scope","$window","upload",e])}(),function(){"use strict";function e(){return{restrict:"A",scope:{fadeVisibleValue:"="},link:function(e,n){var r=$(n);r.toggle(e.fadeVisibleValue),e.$watch("fadeVisibleValue",function(e){e?r.fadeIn():r.fadeOut()})}}}angular.module("design").directive("fadeVisible",e)}(),function(){"use strict";function e(){return{restrict:"A",scope:{src:"="},link:function(e,n){n.css("background-size","cover").css("background-position","center").css("background-repeat","no-repeat").css("background-image","none"),e.$watch("src",function(e){if(n.css("background-image","none"),e){var r=new Image;r.onload=function(){n.css("background-image","url("+e+")")},r.src=e}})}}}angular.module("design").directive("background",e)}(),function(){"use strict";function e(){function e(){var e=$.Deferred(),n=window.parent.localStorageProvider;return n||e.resolve(localStorage["token.settings"]),n.getItem("token.settings").then(function(n){e.resolve(n)}).fail(function(){e.resolve("")}),e.promise()}function r(){var r=$.Deferred();return i.Authorization?r.resolve():e().then(function(e){i.Authorization+="Bearer "+(n("token")||e),r.resolve()}),r.promise()}var t=location.protocol+"//"+location.host+"/storage/image/upload",i={Authorization:""},o={title:"Something went wrong",description:"Please, try again"},a={maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"]};return function(e){function n(e){var n=e.name.split(".").pop().toLowerCase();return $.inArray(n,a.supportedExtensions)===-1?{title:"Unsupported image format",description:"(Allowed formats: "+a.supportedExtensions.join(", ")+")"}:!(e.size>1024*a.maxFileSize*1024)||{title:"File is too large",description:"(Max file size: "+a.maxFileSize+"MB)"}}var s=$.Deferred(),c=$("<form>").hide().attr("method","post").attr("enctype","multipart/form-data").insertAfter("body"),u=$("<input>").attr("accept",a.supportedExtensions.map(function(e){return"."+e}).join(", ")).attr("type","file").attr("name","file").on("change",function(){e&&e();var a=this.files[0],c=n(a);if(c!==!0)return void s.reject(c);var u=new FormData;u.append("file",a),r().then(function(){$.ajax({url:t,type:"POST",headers:i,data:u,contentType:!1,processData:!1}).done(function(e){try{var n=JSON.parse(e);n&&n.success&&n.data&&n.data.url?s.resolve(n.data.url):s.reject(o)}catch(r){s.reject(o)}}).fail(function(){s.reject(o)})})}).appendTo(c);return u.click(),s.promise()}}function n(e){var n=RegExp(e+"=(.+?)(&|$)").exec(location.search)||null;return null===n?null:decodeURI(n[1])}angular.module("design").factory("upload",e)}();