!function(){"use strict";function e(e,n,r){function i(){var e=t();angular.equals(a,e)||s.saveSettings(JSON.stringify(e),null).done(function(){a=e})}function t(e){return $.extend({},e||a,{logo:{url:o.logo.url},background:{image:{src:o.background.image.src,type:o.background.type}}})}var o=e,a=null,s=window.egApi;return o.isError=!1,o.background=new function(){var e=this;e.image={src:null,isUploading:!1,isEmpty:!0},e.type="default",e.setDefault=function(){e.type="default"},e.setRepeat=function(){e.type="repeat"},e.setFullscreen=function(){e.type="fullscreen"},e.errorTitle=null,e.errorDescription=null,e.hasError=!1,e.changeImage=function(){e.image.isUploading||r(function(){e.image.isUploading=!0,e.hasError=!1,e.errorTitle=void 0,e.errorDescription=void 0,o.$apply()}).done(function(n){e.image.src=n,e.image.isEmpty=!1}).fail(function(n){e.image.src=null,e.image.isEmpty=!0,e.hasError=!0,e.errorTitle=n.title,e.errorDescription=n.description}).always(function(){e.image.isUploading=!1,o.$apply()})},e.clearImage=function(){e.image.src=null,e.image.isEmpty=!0},e.init=function(n){n&&n.image&&(n.image.src&&(e.image.src=n.image.src,e.image.isEmpty=!1),n.image.type&&(e.type=n.image.type))}},o.userAccess=function(){function e(e){n.hasStarterPlan=e.accessType>0}var n={};return n.hasStarterPlan=!0,n.init=e,n}(),o.logo=function(){function e(){return""!==u.url}function n(){u.url=""}function i(e){u.url="",e&&e.url&&(u.url=e.url)}function t(){u.isLoading||r(function(){a(),o.$apply()}).done(function(e){u.url=e,s()}).fail(function(e){c(e.title,e.description)}).always(function(){o.$apply()})}function a(){u.clear(),u.isLoading=!0}function s(){u.isLoading=!1,u.hasError=!1}function c(e,n){u.clear(),u.isLoading=!1,u.hasError=!0,u.errorText=e,u.errorDescription=n}var u={};return u.url="",u.isLoading=!1,u.hasError=!1,u.errorText="Unsupported image format",u.errorDescription="(Supported formats: jpg, png, bmp)",u.hasLogo=e,u.clear=n,u.upload=t,u.init=i,u}(),angular.element(n).on("blur",i),s.init().then(function(){var e=s.getUser(),n=s.getSettings();o.userAccess.init(e),o.logo.init(n.logo),o.background.init(n.background),a=t(n)}).fail(function(){o.isError=!0}).always(function(){o.$applyAsync()})}angular.module("design",[]).controller("DesignController",["$scope","$window","upload",e])}(),function(){"use strict";function e(){return{restrict:"A",scope:{fadeVisibleValue:"="},link:function(e,n){var r=$(n);r.toggle(e.fadeVisibleValue),e.$watch("fadeVisibleValue",function(e){e?r.fadeIn():r.fadeOut()})}}}angular.module("design").directive("fadeVisible",e)}(),function(){"use strict";function e(){return{restrict:"A",scope:{src:"="},link:function(e,n){n.css("background-size","cover").css("background-position","center").css("background-repeat","no-repeat").css("background-image","none"),e.$watch("src",function(e){if(n.css("background-image","none"),e){var r=new Image;r.onload=function(){n.css("background-image","url("+e+")")},r.src=e}})}}}angular.module("design").directive("background",e)}(),function(){"use strict";function e(){var e=location.protocol+"//"+location.host+"/storage/image/upload",n={title:"Something went wrong",description:"Please, try again"},r={maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"]};return function(i){function t(e){var n=e.name.split(".").pop().toLowerCase();return-1===$.inArray(n,r.supportedExtensions)?{title:"Unsupported image format",description:"(Allowed formats: "+r.supportedExtensions.join(", ")+")"}:e.size>1024*r.maxFileSize*1024?{title:"File is too large",description:"(Max file size: "+r.maxFileSize+"MB)"}:!0}var o=$.Deferred(),a=$("<form>").hide().attr("method","post").attr("enctype","multipart/form-data").insertAfter("body"),s=$("<input>").attr("accept",r.supportedExtensions.map(function(e){return"."+e}).join(", ")).attr("type","file").attr("name","file").on("change",function(){i&&i();var r=this.files[0],a=t(r);if(a!==!0)return void o.reject(a);var s=new FormData;s.append("file",r),$.ajax({url:e,type:"POST",data:s,contentType:!1,processData:!1}).done(function(e){try{var r=JSON.parse(e);r&&r.success&&r.data&&r.data.url?o.resolve(r.data.url):o.reject(n)}catch(i){o.reject(n)}}).fail(function(){o.reject(n)})}).appendTo(a);return s.click(),o.promise()}}angular.module("design").factory("upload",e)}();