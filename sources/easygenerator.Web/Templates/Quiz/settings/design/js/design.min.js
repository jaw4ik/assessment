!function(){"use strict";function e(e,n,r){function t(){var e=i();angular.equals(a,e)||c.saveSettings(JSON.stringify(e),null).done(function(){a=e})}function i(e){return $.extend({},e||a,{logo:{url:o.logo.url},background:{image:{src:o.background.image.src,type:o.background.type}}})}var o=e,a=null,c=window.egApi;return o.isError=!1,o.background=new function(){var e=this;e.image={src:null,isUploading:!1,isEmpty:!0},e.type="default",e.setDefault=function(){e.type="default"},e.setRepeat=function(){e.type="repeat"},e.setFullscreen=function(){e.type="fullscreen"},e.errorTitle=null,e.errorDescription=null,e.hasError=!1,e.changeImage=function(){e.image.isUploading||r(function(){e.image.isUploading=!0,e.hasError=!1,e.errorTitle=void 0,e.errorDescription=void 0,o.$apply()}).done(function(n){e.image.src=n,e.image.isEmpty=!1}).fail(function(n){e.image.src=null,e.image.isEmpty=!0,e.hasError=!0,e.errorTitle=n.title,e.errorDescription=n.description}).always(function(){e.image.isUploading=!1,o.$apply()})},e.clearImage=function(){e.image.src=null,e.image.isEmpty=!0},e.init=function(n){n&&n.image&&(n.image.src&&(e.image.src=n.image.src,e.image.isEmpty=!1),n.image.type&&(e.type=n.image.type))}},o.userAccess=function(){function e(e){n.hasStarterPlan=e.accessType>0}var n={};return n.hasStarterPlan=!0,n.init=e,n}(),o.logo=function(){function e(){return""!==u.url}function n(){u.url=""}function t(e){u.url="",e&&e.url&&(u.url=e.url)}function i(){l||r(function(){a()}).done(function(e){u.url=e,c()}).fail(function(e){s(e.title,e.description)}).always(function(){o.$apply()})}function a(){l=!0}function c(){l=!1,u.hasError=!1}function s(e,n){l=!1,u.clear(),u.errorText=e,u.errorDescription=n,u.hasError=!0}var u={},l=!1;return u.url="",u.hasError=!1,u.errorText="Unsupported image format",u.errorDescription="(Supported formats: jpg, png, bmp)",u.hasLogo=e,u.clear=n,u.upload=i,u.init=t,u}(),angular.element(n).on("blur",t),c.init().then(function(){var e=c.getUser(),n=c.getSettings();o.userAccess.init(e),o.logo.init(n.logo),o.background.init(n.background),a=i(n)}).fail(function(){o.isError=!0}).always(function(){o.$applyAsync()})}angular.module("design",[]).controller("DesignController",["$scope","$window","upload",e])}(),function(){"use strict";function e(){return{restrict:"A",scope:{fadeVisibleValue:"="},link:function(e,n){var r=$(n);r.toggle(e.fadeVisibleValue),e.$watch("fadeVisibleValue",function(e){e?r.fadeIn():r.fadeOut()})}}}angular.module("design").directive("fadeVisible",e)}(),function(){"use strict";function e(){return{restrict:"A",scope:{src:"="},link:function(e,n){n.css("background-size","cover").css("background-position","center").css("background-repeat","no-repeat").css("background-image","none"),e.$watch("src",function(e){if(n.css("background-image","none"),e){var r=new Image;r.onload=function(){n.css("background-image","url("+e+")")},r.src=e}})}}}angular.module("design").directive("background",e)}(),function(){"use strict";function e(){var e=location.protocol+"//"+location.host+"/storage/image/upload",n=localStorage["token.settings"],r=void 0!==n,t=r?{Authorization:"Bearer "+n}:{},i={title:"Something went wrong",description:"Please, try again"},o={maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"]};return function(n){function r(e){var n=e.name.split(".").pop().toLowerCase();return-1===$.inArray(n,o.supportedExtensions)?{title:"Unsupported image format",description:"(Allowed formats: "+o.supportedExtensions.join(", ")+")"}:e.size>1024*o.maxFileSize*1024?{title:"File is too large",description:"(Max file size: "+o.maxFileSize+"MB)"}:!0}var a=$.Deferred(),c=$("<form>").hide().attr("method","post").attr("enctype","multipart/form-data").insertAfter("body"),s=$("<input>").attr("accept",o.supportedExtensions.map(function(e){return"."+e}).join(", ")).attr("type","file").attr("name","file").on("change",function(){n&&n();var o=this.files[0],c=r(o);if(c!==!0)return void a.reject(c);var s=new FormData;s.append("file",o),$.ajax({url:e,type:"POST",headers:t,data:s,contentType:!1,processData:!1}).done(function(e){try{var n=JSON.parse(e);n&&n.success&&n.data&&n.data.url?a.resolve(n.data.url):a.reject(i)}catch(r){a.reject(i)}}).fail(function(){a.reject(i)})}).appendTo(c);return s.click(),a.promise()}}angular.module("design").factory("upload",e)}();