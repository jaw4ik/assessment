!function(){"use strict";function e(e,n,t){function r(){var e=i();angular.equals(a,e)||u.saveSettings(JSON.stringify(e),null).done(function(){a=e})}function i(e){return $.extend({},e||a,{logo:{url:o.logo.url}})}var o=e,a=null,u=window.egApi;return o.isError=!1,o.userAccess=function(){function e(e){n.hasStarterPlan=e.accessType>0}var n={};return n.hasStarterPlan=!0,n.init=e,n}(),o.logo=function(){function e(){return""!==l.url}function n(){l.url=""}function r(e){l.url="",e&&e.url&&(l.url=e.url)}function i(){l.isLoading||t(function(){a(),o.$apply()}).done(function(e){l.url=e,u()}).fail(function(e){s(e.title,e.description)}).always(function(){o.$apply()})}function a(){l.clear(),l.isLoading=!0}function u(){l.isLoading=!1,l.hasError=!1}function s(e,n){l.clear(),l.isLoading=!1,l.hasError=!0,l.errorText=e,l.errorDescription=n}var l={};return l.url="",l.isLoading=!1,l.hasError=!1,l.errorText="Unsupported image format",l.errorDescription="(Supported formats: jpg, png, bmp)",l.hasLogo=e,l.clear=n,l.upload=i,l.init=r,l}(),angular.element(n).on("blur",r),u.init().then(function(){var e=u.getUser(),n=u.getSettings();o.userAccess.init(e),o.logo.init(n.logo),a=i(n)}).fail(function(){o.isError=!0}).always(function(){o.$applyAsync()})}angular.module("design",[]).controller("DesignController",["$scope","$window","upload",e])}(),function(){"use strict";function e(){return{restrict:"A",scope:{fadeVisibleValue:"="},link:function(e,n){var t=$(n);t.toggle(e.fadeVisibleValue),e.$watch("fadeVisibleValue",function(e){e?t.fadeIn():t.fadeOut()})}}}angular.module("design").directive("fadeVisible",e)}(),function(){"use strict";function e(){var e=location.protocol+"//"+location.host+"/storage/image/upload",n={title:"Something went wrong",description:"Please, try again"},t={maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"]};return function(r){function i(e){var n=e.name.split(".").pop().toLowerCase();return-1===$.inArray(n,t.supportedExtensions)?{title:"Unsupported image format",description:"(Allowed formats: "+t.supportedExtensions.join(", ")+")"}:e.size>1024*t.maxFileSize*1024?{title:"File is too large",description:"(Max file size: "+t.maxFileSize+"MB)"}:!0}var o=$.Deferred(),a=$("<form>").hide().attr("method","post").attr("enctype","multipart/form-data").insertAfter("body"),u=$("<input>").attr("accept",t.supportedExtensions.map(function(e){return"."+e}).join(", ")).attr("type","file").attr("name","file").on("change",function(){r&&r();var t=this.files[0],a=i(t);if(a!==!0)return void o.reject(a);var u=new FormData;u.append("file",t),$.ajax({url:e,type:"POST",data:u,contentType:!1,processData:!1}).done(function(e){try{var t=JSON.parse(e);t&&t.success&&t.data&&t.data.url?o.resolve(t.data.url):o.reject(n)}catch(r){o.reject(n)}}).fail(function(){o.reject(n)})}).appendTo(a);return u.click(),o.promise()}}angular.module("design").factory("upload",e)}();