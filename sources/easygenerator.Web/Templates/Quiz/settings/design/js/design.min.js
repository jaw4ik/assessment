!function(){"use strict";function t(t,e){function i(){var t=n();angular.equals(s,t)||window.egApi.saveSettings(JSON.stringify(t),null).done(function(){s=t})}function n(t){return $.extend({},t||s,{logo:{url:o.logo.url}})}var o=t,a=location.protocol+"//"+location.host,s=null;o.userAccess=function(){function t(t){e.hasStarterPlan=t.accessType>0}var e={};return e.hasStarterPlan=!0,e.init=t,e}(),o.logo=function(){function t(){return""!==n.url}function e(){n.url=""}function i(t){n.url="",t&&t.url&&(n.url=t.url)}var n={};return n.url="",n.hasError=!1,n.errorText="Unsupported image format",n.errorDescription="(Supported formats: jpg, png, bmp)",n.isLoading=!1,n.hasLogo=t,n.clear=e,n.init=i,n}(),angular.element(e).on("blur",i);var l={apiUrl:a+"/storage/image/upload",maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"],somethingWentWrongMessage:{title:"Something went wrong",description:"Please, try again"},status:{"default":function(){o.logo.isLoading=!1,o.logo.hasError=!1,o.$apply()},fail:function(t){o.logo.clear(),o.logo.isLoading=!1,o.logo.errorText=t.title,o.logo.errorDescription=t.description,o.logo.hasError=!0,o.$apply()},loading:function(){o.logo.isLoading=!0,o.$apply()}},button:{enable:function(){this.$input.attr("disabled",!1).closest(".image-upload-button").removeClass("disabled")},disable:function(){this.$input.attr("disabled",!0).closest(".image-upload-button").addClass("disabled")},submit:function(){this.$input[0].form.submit(),this.disable(),l.status.loading()},$input:$("#logoInput")},init:function(){l.button.$input.on("change",l.processFile),l.button.enable()},processFile:function(){if(!this.files)return void l.button.submit();if(0!==this.files.length){var t=this.files[0],e=t.name.split(".").pop().toLowerCase();return-1===$.inArray(e,l.supportedExtensions)?void l.status.fail({title:"Unsupported image format",description:"(Allowed formats: "+l.supportedExtensions.join(", ")+")"}):t.size>1024*l.maxFileSize*1024?void l.status.fail({title:"File is too large",description:"(Max file size: "+l.maxFileSize+"MB)"}):void l.uploadFile(t)}},uploadFile:function(t){l.button.disable(),l.status.loading();var e=new FormData;e.append("file",t),$.ajax({url:l.apiUrl,type:"POST",data:e,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(t){l.handleResponse(t)}).fail(function(){l.status.fail(l.somethingWentWrongMessage),l.button.enable()})},handleResponse:function(t){try{if(!t)throw"Response is empty";if("object"!=typeof t&&(t=JSON.parse(t)),!t||!t.success||!t.data)throw"Request is not successful";o.logo.url=t.data.url,o.$apply(),l.status.default()}catch(e){l.status.fail(l.somethingWentWrongMessage)}finally{l.button.enable()}}},r=window.egApi;return r.init().then(function(){var t=r.getUser(),e=r.getSettings();o.userAccess.init(t),o.logo.init(e.logo),o.userAccess.hasStarterPlan&&l.init(),s=n(e),o.$applyAsync()}).fail(function(){r.sendNotificationToEditor("Settings are not initialized.",!1)})}angular.module("design",[]).controller("DesignController",["$scope","$window",t])}(),function(){"use strict";function t(){return{restrict:"A",scope:{fadeVisibleValue:"="},link:function(t,e){var i=$(e);i.toggle(t.fadeVisibleValue),t.$watch("fadeVisibleValue",function(t){t?i.fadeIn():i.fadeOut()})}}}angular.module("design").directive("fadeVisible",t)}();