!function(){"use strict";function e(e,t,n,a){function i(){var e=o();angular.equals(l,e)||window.egApi.saveSettings(JSON.stringify(e),null).done(function(){l=e})}function o(){return{logo:{url:s.logo.url},xApi:{enabled:s.trackingData.enableXAPI,selectedLrs:s.trackingData.selectedLrs,lrs:{uri:s.trackingData.lrsUrl,authenticationRequired:s.trackingData.authenticationRequired,credentials:{username:s.trackingData.lapLogin,password:s.trackingData.lapPassword}},allowedVerbs:$.map(s.trackingData.statements,function(e,t){return e?t:void 0})},masteryScore:{score:s.masteryScore.value||0},languages:{selected:s.languages.selectedLanguageCode,customTranslations:s.languages.getCustomTranslations()}}}var s=e,r=location.protocol+"//"+location.host,l=null;s.userAccess=function(){function e(e){t.hasStarterPlan=e.accessType>0}var t={};return t.hasStarterPlan=!0,t.init=e,t}(),s.logo=function(){function e(){return""!==a.url}function t(){a.url=""}function n(e){a.url="",e&&e.url&&(a.url=e.url)}var a={};return a.url="",a.hasError=!1,a.errorText="Unsupported image format",a.errorDescription="(Supported formats: jpg, png, bmp)",a.isLoading=!1,a.hasLogo=e,a.clear=t,a.init=n,a}(),s.trackingData=function(){function e(){return i.enableXAPI&&i.selectedLrs!==i.lrsOptions[0].key}function t(){return i.customLrsEnabled()&&i.authenticationRequired}function n(){i.advancedSettingsExpanded=!i.advancedSettingsExpanded}function a(e){i.enableXAPI=e.enabled||!1;var t=e.enabled?"custom":"default";i.selectedLrs=e.selectedLrs||t,i.lrsUrl=e.lrs.uri||"",i.authenticationRequired=e.lrs.authenticationRequired||!1,i.lapLogin=e.lrs.credentials.username||"",i.lapPassword=e.lrs.credentials.password||"";var n;if(e.allowedVerbs)for(n in i.statements)i.statements.hasOwnProperty(n)&&(i.statements[n]=e.allowedVerbs.indexOf(n)>-1)}var i={};return i.enableXAPI=!0,i.lrsOptions=[{key:"default",text:"easygenerator (recommended)"},{key:"custom",text:"custom LRS"}],i.selectedLrs=i.lrsOptions[0].key,i.lrsOptions.forEach(function(e){e.isSelected=function(){return i.selectedLrs===e.key},e.select=function(){i.lrsOptions.forEach(function(e){e.isSelected(!1)}),e.isSelected(!0),i.selectedLrs=e.key}}),i.customLrsEnabled=e,i.lrsUrl="",i.authenticationRequired=!1,i.lapLogin="",i.lapPassword="",i.credentialsEnabled=t,i.statements={started:!0,stopped:!0,experienced:!0,mastered:!0,answered:!0,passed:!0,failed:!0},i.advancedSettingsExpanded=!1,i.toggleAdvancedSettings=n,i.init=a,i}(),s.masteryScore=function(){function e(e){t.value=e&&e.score>=0&&e.score<=100?e.score:100}var t={};return t.value=0,t.init=e,t}(),s.languages=function(){function e(){var e=n(l);return e?e.resources:{}}function t(e,t){e.forEach(function(e){o.languagesList.push(new i(e.code,e.name,e.url,!1))});var a=n(r),s=new i(l,"Custom",a?a.resourcesUrl:null,!0,t?t.customTranslations:null);o.languagesList.push(s),o.selectedLanguageCode=t&&t.selected?t.selected:r}function n(e){return a("filter")(o.languagesList,{code:e})[0]}function i(e,t,n,a,i){function o(){return l?$.when():r(u.resourcesUrl).then(function(e){u.resources=$.isEmptyObject(u.resources)?e:s(u.resources,e),l=!0})}function s(e,t){var n={};return $.each(t,function(t,a){n[t]="string"==typeof e[t]?e[t]:a}),n}function r(e){return $.ajax({url:e,dataType:"json",contentType:"application/json"})}var l=!1,u=this;u.code=e,u.name=t,u.isEditable=a,u.resourcesUrl=n,u.resources=i||{},u.load=o}var o={},r="en",l="xx";return o.languagesList=[],o.selectedLanguageCode="",o.selectedLanguage=null,o.getCustomTranslations=e,o.init=t,s.$watch("languages.selectedLanguageCode",function(){var e=n(o.selectedLanguageCode);e&&e.load().then(function(){o.selectedLanguage=e,s.$applyAsync()})}),o}(),angular.element(t).on("blur",i);var u={apiUrl:r+"/storage/image/upload",maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"],somethingWentWrongMessage:{title:"Something went wrong",description:"Please, try again"},status:{"default":function(){s.logo.isLoading=!1,s.logo.hasError=!1,s.$apply()},fail:function(e){s.logo.clear(),s.logo.isLoading=!1,s.logo.errorText=e.title,s.logo.errorDescription=e.description,s.logo.hasError=!0,s.$apply()},loading:function(){s.logo.isLoading=!0,s.$apply()}},button:{enable:function(){this.$input.attr("disabled",!1).closest(".image-upload-button").removeClass("disabled")},disable:function(){this.$input.attr("disabled",!0).closest(".image-upload-button").addClass("disabled")},submit:function(){this.$input[0].form.submit(),this.disable(),u.status.loading()},$input:$("#logoInput")},init:function(){u.button.$input.on("change",u.processFile),u.button.enable()},processFile:function(){if(!this.files)return void u.button.submit();if(0!==this.files.length){var e=this.files[0],t=e.name.split(".").pop().toLowerCase();return-1===$.inArray(t,u.supportedExtensions)?void u.status.fail({title:"Unsupported image format",description:"(Allowed formats: "+u.supportedExtensions.join(", ")+")"}):e.size>1024*u.maxFileSize*1024?void u.status.fail({title:"File is too large",description:"(Max file size: "+u.maxFileSize+"MB)"}):void u.uploadFile(e)}},uploadFile:function(e){u.button.disable(),u.status.loading();var t=new FormData;t.append("file",e),$.ajax({url:u.apiUrl,type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(e){u.handleResponse(e)}).fail(function(){u.status.fail(u.somethingWentWrongMessage),u.button.enable()})},handleResponse:function(e){try{if(!e)throw"Response is empty";if("object"!=typeof e&&(e=JSON.parse(e)),!e||!e.success||!e.data)throw"Request is not successful";s.logo.url=e.data.url,s.$apply(),u.status.default()}catch(t){u.status.fail(u.somethingWentWrongMessage)}finally{u.button.enable()}}},c=window.egApi;return c.init().then(function(){var e=c.getManifest(),t=c.getUser(),n=c.getSettings();s.userAccess.init(t),s.logo.init(n.logo),s.trackingData.init(n.xApi),s.masteryScore.init(n.masteryScore),s.languages.init(e.languages,n.languages),s.userAccess.hasStarterPlan&&u.init(),l=o(),s.$applyAsync()}).fail(function(){c.sendNotificationToEditor("Settings are not initialized.",!1)})}angular.module("settings",[]).controller("SettingsController",["$scope","$window","$q","$filter",e])}(),function(){"use strict";function e(){return{restrict:"A",link:function(e,t){var n=$(t),a="data-tab-link",i="data-tab",o="active",s=n.find("["+a+"]"),r=n.find("["+i+"]");r.hide(),s.first().addClass(o),r.first().show(),s.each(function(e,t){var l=$(t);l.on("click",function(){var e=l.attr(a),t=n.find("["+i+'="'+e+'"]');s.removeClass(o),l.addClass(o),r.hide(),t.show()})})}}}function t(){return{restrict:"A",link:function(e,t){$(t).on("dragstart",function(e){e.preventDefault()})}}}function n(){return{restrict:"A",scope:{spinnerValue:"="},link:function(e,t){$(t).spinner("changed",function(t,n){e.spinnerValue=n,e.$apply()})}}}function a(){return{restrict:"A",scope:{numberValue:"="},link:function(e,t){var n=$(t),a=100;n.on("keydown",function(e){var t=e.charCode||e.keyCode||0;return 8===t||9===t||46===t||t>=37&&40>=t||t>=48&&57>=t||t>=96&&105>=t}),n.on("keyup",function(){e.numberValue>a&&(e.numberValue=a,e.$apply())})}}}function i(){return{restrict:"A",scope:{fadeVisibleValue:"="},link:function(e,t){var n=$(t);n.toggle(e.fadeVisibleValue),e.$watch("fadeVisibleValue",function(e){e?n.fadeIn():n.fadeOut()})}}}function o(){return{restrict:"A",scope:{toggleValue:"="},link:function(e,t){function n(){function e(e){o(e),s(e)}function t(){var e=n();o(!e),l.stop().animate({marginLeft:r(!e)},250)}function n(){return i.hasClass("on")}function a(t){n()!==t&&e(t)}function o(e){i.toggleClass("on",e),i.toggleClass("off",!e)}function s(e){l.css("margin-left",r(e)+"px")}function r(e){return e?0:i.height()-i.width()}var l=$(".switch-toggle-wrapper",i);return{setInitialValue:e,updateValue:a,toggle:t}}function a(e){var t=!1;i.mousedown(function(n){1===n.which&&(t=!0,e())}),i.click(function(){return t?void(t=!1):void e()})}var i=$(t),o=n();o.setInitialValue(e.toggleValue),e.$watch("toggleValue",function(e){o.updateValue(e)}),a(function(){o.toggle(),e.toggleValue=!e.toggleValue,e.$apply()})}}}function s(){return{restrict:"E",scope:{options:"=",value:"=",optionsValue:"=",optionsText:"="},link:function(e,t){var n={dropdown:"dropdown",disabled:"disabled",expanded:"expanded",optionsList:"dropdown-options-list",optionItem:"dropdown-options-item",currentItem:"dropdown-current-item",currentItemText:"dropdown-current-item-text",indicatorHolder:"dropdown-indicator-holder",indicator:"dropdown-indicator"};t.addClass(n.dropdown);var a=$("<div />").addClass(n.currentItem).appendTo(t);$("<div />").addClass(n.currentItemText).appendTo(a);var i=$("<div />").addClass(n.indicatorHolder).appendTo(a);$("<span />").addClass(n.indicator).appendTo(i),$("<ul />").addClass(n.optionsList).appendTo(t),a.on("click",function(e){t.hasClass(n.disabled)||(a.toggleClass(n.expanded),e.stopPropagation())});var o=function(){a.removeClass(n.expanded)};$("html").bind("click",o),$(window).bind("blur",o),e.$watchGroup(["options","value"],function(a){var i=t.find("ul."+n.optionsList),o=t.find("div."+n.currentItemText),s=a[0],r=a[1],l=e.optionsText,u=e.optionsValue;i.empty(),$.each(s,function(t,a){return a[u]==r?void o.text(a[l]):void $("<li />").addClass(n.optionItem).appendTo(i).text(a[l]).on("click",function(){e.value=a[u],e.$apply()})})})}}}function r(){return function(e){return e?Object.keys(e):[]}}angular.module("settings").directive("tabs",e).directive("switchToggle",o).directive("disableDragAndDrop",t).directive("spinner",n).directive("number",a).directive("fadeVisible",i).directive("dropdown",s).filter("keys",r)}();