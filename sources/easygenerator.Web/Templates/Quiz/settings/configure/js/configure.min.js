!function(){"use strict";function e(e,n,t){function a(){var e=r();angular.equals(o,e)||s.saveSettings(JSON.stringify(e),null).done(function(){o=e})}function r(e){return $.extend({},e||o,{xApi:{enabled:i.trackingData.enableXAPI,selectedLrs:i.trackingData.selectedLrs,lrs:{uri:i.trackingData.lrsUrl,authenticationRequired:i.trackingData.authenticationRequired,credentials:{username:i.trackingData.lapLogin,password:i.trackingData.lapPassword}},allowedVerbs:$.map(i.trackingData.statements,function(e,n){return e?n:void 0})},masteryScore:{score:i.masteryScore.value||0},languages:{selected:i.languages.selectedLanguageCode,customTranslations:i.languages.getCustomTranslations()}})}var i=e,o=null,s=window.egApi;return i.trackingData=function(){function e(){return r.enableXAPI&&r.selectedLrs!==r.lrsOptions[0].key}function n(){return r.customLrsEnabled()&&r.authenticationRequired}function t(){r.advancedSettingsExpanded=!r.advancedSettingsExpanded}function a(e){r.enableXAPI=e.enabled||!1;var n=e.enabled?"custom":"default";r.selectedLrs=e.selectedLrs||n,r.lrsUrl=e.lrs.uri||"",r.authenticationRequired=e.lrs.authenticationRequired||!1,r.lapLogin=e.lrs.credentials.username||"",r.lapPassword=e.lrs.credentials.password||"";var t;if(e.allowedVerbs)for(t in r.statements)r.statements.hasOwnProperty(t)&&(r.statements[t]=e.allowedVerbs.indexOf(t)>-1)}var r={};return r.enableXAPI=!0,r.lrsOptions=[{key:"default",text:"easygenerator (recommended)"},{key:"custom",text:"custom LRS"}],r.selectedLrs=r.lrsOptions[0].key,r.lrsOptions.forEach(function(e){e.isSelected=function(){return r.selectedLrs===e.key},e.select=function(){r.lrsOptions.forEach(function(e){e.isSelected(!1)}),e.isSelected(!0),r.selectedLrs=e.key}}),r.customLrsEnabled=e,r.lrsUrl="",r.authenticationRequired=!1,r.lapLogin="",r.lapPassword="",r.credentialsEnabled=n,r.statements={started:!0,stopped:!0,experienced:!0,mastered:!0,answered:!0,passed:!0,failed:!0},r.advancedSettingsExpanded=!1,r.toggleAdvancedSettings=t,r.init=a,r}(),i.masteryScore=function(){function e(e){n.value=e&&e.score>=0&&e.score<=100?e.score:100}var n={};return n.value=0,n.init=e,n}(),i.languages=function(){function e(){var e=a(u);return e?e.resources:{}}function n(e,n){e.forEach(function(e){o.languagesList.push(new r(e.code,e.name,e.url,!1))});var t=a(s),i=new r(u,"Custom",t?t.resourcesUrl:null,!0,n?n.customTranslations:null);o.languagesList.push(i),o.selectedLanguageCode=n&&n.selected?n.selected:s}function a(e){return t("filter")(o.languagesList,{code:e})[0]}function r(e,n,t,a,r){function i(){return u?$.when():s(c.resourcesUrl).then(function(e){c.resources=$.isEmptyObject(c.resources)?e:o(c.resources,e),u=!0})}function o(e,n){var t={};return $.each(n,function(n,a){t[n]="string"==typeof e[n]?e[n]:a}),t}function s(e){return $.ajax({url:e,dataType:"json",contentType:"application/json"})}var u=!1,c=this;c.code=e,c.name=n,c.isEditable=a,c.resourcesUrl=t,c.resources=r||{},c.load=i}var o={},s="en",u="xx";return o.languagesList=[],o.selectedLanguageCode="",o.selectedLanguage=null,o.getCustomTranslations=e,o.init=n,i.$watch("languages.selectedLanguageCode",function(){var e=a(o.selectedLanguageCode);e&&e.load().then(function(){o.selectedLanguage=e,i.$applyAsync()})}),o}(),angular.element(n).on("blur",a),s.init().then(function(){var e=s.getManifest(),n=s.getSettings();i.trackingData.init(n.xApi),i.masteryScore.init(n.masteryScore),i.languages.init(e.languages,n.languages),o=r(n),i.$applyAsync()}).fail(function(){s.sendNotificationToEditor("Settings are not initialized.",!1)})}angular.module("configure",[]).controller("ConfigureController",["$scope","$window","$filter",e])}(),function(){"use strict";function e(){return{restrict:"A",link:function(e,n){var t=$(n),a="data-tab-link",r="data-tab",i="active",o=t.find("["+a+"]"),s=t.find("["+r+"]");s.hide(),o.first().addClass(i),s.first().show(),o.each(function(e,n){var u=$(n);u.on("click",function(){var e=u.attr(a),n=t.find("["+r+'="'+e+'"]');o.removeClass(i),u.addClass(i),s.hide(),n.show()})})}}}function n(){return{restrict:"A",scope:{toggleValue:"="},link:function(e,n){function t(){function e(e){i(e),o(e)}function n(){var e=t();i(!e),u.stop().animate({marginLeft:s(!e)},250)}function t(){return r.hasClass("on")}function a(n){t()!==n&&e(n)}function i(e){r.toggleClass("on",e),r.toggleClass("off",!e)}function o(e){u.css("margin-left",s(e)+"px")}function s(e){return e?0:r.height()-r.width()}var u=$(".switch-toggle-wrapper",r);return{setInitialValue:e,updateValue:a,toggle:n}}function a(e){var n=!1;r.mousedown(function(t){1===t.which&&(n=!0,e())}),r.click(function(){return n?void(n=!1):void e()})}var r=$(n),i=t();i.setInitialValue(e.toggleValue),e.$watch("toggleValue",function(e){i.updateValue(e)}),a(function(){i.toggle(),e.toggleValue=!e.toggleValue,e.$apply()})}}}function t(){return{restrict:"A",link:function(e,n){$(n).on("dragstart",function(e){e.preventDefault()})}}}function a(){return{restrict:"A",scope:{spinnerValue:"="},link:function(e,n){$(n).spinner("changing",function(n,t){e.spinnerValue=t,e.$apply()})}}}function r(){return{restrict:"A",scope:{numberValue:"="},link:function(e,n){var t=$(n),a=100;t.on("keydown",function(e){var n=e.charCode||e.keyCode||0;return 8===n||9===n||46===n||n>=37&&40>=n||n>=48&&57>=n||n>=96&&105>=n}),t.on("keyup",function(){e.numberValue>a&&(e.numberValue=a,e.$apply())})}}}function i(){return{restrict:"E",scope:{options:"=",value:"=",optionsValue:"=",optionsText:"="},link:function(e,n){var t={dropdown:"dropdown",disabled:"disabled",expanded:"expanded",optionsList:"dropdown-options-list",optionItem:"dropdown-options-item",currentItem:"dropdown-current-item",currentItemText:"dropdown-current-item-text",indicatorHolder:"dropdown-indicator-holder",indicator:"dropdown-indicator"};n.addClass(t.dropdown);var a=$("<div />").addClass(t.currentItem).appendTo(n);$("<div />").addClass(t.currentItemText).appendTo(a);var r=$("<div />").addClass(t.indicatorHolder).appendTo(a);$("<span />").addClass(t.indicator).appendTo(r),$("<ul />").addClass(t.optionsList).appendTo(n),a.on("click",function(e){n.hasClass(t.disabled)||(a.toggleClass(t.expanded),e.stopPropagation())});var i=function(){a.removeClass(t.expanded)};$("html").bind("click",i),$(window).bind("blur",i),e.$watchGroup(["options","value"],function(a){var r=n.find("ul."+t.optionsList),i=n.find("div."+t.currentItemText),o=a[0],s=a[1],u=e.optionsText,c=e.optionsValue;r.empty(),$.each(o,function(n,a){return a[c]==s?void i.text(a[u]):void $("<li />").addClass(t.optionItem).appendTo(r).text(a[u]).on("click",function(){e.value=a[c],e.$apply()})})})}}}function o(){return function(e){return e?Object.keys(e):[]}}angular.module("configure").directive("tabs",e).directive("switchToggle",n).directive("disableDragAndDrop",t).directive("spinner",a).directive("number",r).directive("dropdown",i).filter("keys",o)}();