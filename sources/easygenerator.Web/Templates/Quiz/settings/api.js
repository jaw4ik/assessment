!function(){function e(){var e=$.ajax({url:h,headers:v,cache:!1,type:"POST",contentType:"application/json",dataType:"json"}),t=$.ajax({url:T,headers:v,cache:!1,contentType:"application/json",dataType:"json"}),n=$.ajax({url:S,headers:v,cache:!1,contentType:"application/json",dataType:"json"});return $.when(n,e,t).done(function(e,t,n){g.manifest=s(e[0]),g.user=o(t[0]),g.settings=r(n[0]),g.isInited=!0})}function t(){if(!g.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function n(){return t(),g.manifest}function a(){return t(),g.user}function i(){return t(),g.settings}function s(e){if(e&&e.languages&&e.languages.length>0)for(var t=0;t<e.languages.length;t++)e.languages[t].url=j+e.languages[t].url;return e}function o(e){e=e.data;var t={accessType:0},n=1;return e.subscription&&e.subscription.accessType&&e.subscription.accessType>=n&&new Date(e.subscription.expirationDate)>=new Date&&(t.accessType=e.subscription.accessType),t}function r(e){var t;return t=e.settings&&e.settings.length>0?JSON.parse(e.settings):{xApi:{enabled:!0,selectedLrs:"default",lrs:{credentials:{}}},masteryScore:{}}}function c(e){var t=RegExp(e+"=(.+?)(&|$)").exec(location.search)||null;return null===t?null:decodeURI(t[1])}function u(e,t,n,a){l();var i={settings:e,extraSettings:t},s={url:T,type:"POST",headers:v,cache:!1,dataType:"json",data:i};return $.ajax(s).done(function(){d(n,!0)}).fail(function(){d(a,!1)}).always(function(){p()})}function l(){f({type:"freeze",data:{freezeEditor:!0}})}function p(){f({type:"freeze",data:{freezeEditor:!1}})}function f(e){var t=window.top;t.postMessage(e,t.location.href)}function d(e,t){f({type:"notification",data:{success:t,message:e}})}var g={isInited:!1},y=location.protocol+"//"+location.host,h=y+"/auth/identity",T=y+"/api/course/"+c("courseId")+"/template/"+c("templateId"),j=location.toString().substring(0,location.toString().indexOf("/settings/"))+"/",S=j+"manifest.json",v={Authorization:"Bearer "+(c("token")||localStorage["token.settings"])};window.egApi={init:e,getManifest:n,getUser:a,getSettings:i,saveSettings:u,sendNotificationToEditor:d}}();