!function(e){e.localize=function(e){return t[e]};var t={"default":"easygenerator (recommended)",custom:"Custom LRS",xx:"Custom",en:"English",ua:"Ukrainian","changes are saved":"All changes are saved","changes are not saved":"Changes have NOT been saved. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists.","settings are not initialize":"Template settings are not initialized. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists.","graphical customization":"Graphical customization","results tracking":"Results Tracking","template language":"Template language","customize your course":"Customize your course","look and feel of the course":"Change the look and feel of the course","custom course logo":"Custom course logo:",or:"or","upload logo image":"Upload logo image","logo hint":"Your logo will appear here<p>(recommended size 300 x 50 px)</p>","clear logo":"Clear logo","upgrade account hint":'You have to <a target="_blank" href="/account/upgrade">upgrade your account</a> in order to set custom course logo',"track and trace settings":"Track and trace settings",disabled:"Disabled",enabled:"Enabled","advanced settings":"Advanced settings","report to":"Report to:","custom lrs settings":"Custom LRS settings","lrs url":"LRS URL","authentication required":"Authentication required","lap login":"LAP login","lap password":"LAP password","use statements":"Use statements:",started:"Started",stopped:"Stopped",passed:"Passed",mastered:"Mastered",failed:"Failed","choose language for your course":"Choose language for your course",defaultText:"Default",translation:"Translation"}}(window.app=window.app||{}),function(){ko.bindingHandlers.fadeVisible={init:function(e,t){var n=t();$(e).toggle(ko.unwrap(n))},update:function(e,t){var n=t();ko.unwrap(n)?$(e).fadeIn():$(e).fadeOut()}},ko.bindingHandlers.number={init:function(e){var t=$(e),n=100;t.on("keydown",function(e){var t=e.charCode||e.keyCode||0;return 8==t||9==t||46==t||t>=37&&40>=t||t>=48&&57>=t||t>=96&&105>=t}),t.on("keyup",function(){$(this).val()>n&&$(this).val(n)})}},ko.bindingHandlers.disableDragNDrop={init:function(e){$(e).on("dragstart",function(e){e.preventDefault()})}},ko.bindingHandlers.switchToggle={init:function(e,t){var n=ko.bindingHandlers.switchToggle,a=n.viewModel(e,t),o=ko.unwrap(t().value());a.setInitialValue(o),n.onClick(e,function(){a.toggle();var e=ko.unwrap(t().value());t().value(!e)})},update:function(e,t){var n=ko.bindingHandlers.switchToggle.viewModel(e,t),a=ko.unwrap(t().value());n.updateValue(a)},viewModel:function(e){function t(e){i(e),s(e)}function n(){var e=a();i(!e),u.stop().animate({marginLeft:r(!e)},250)}function a(){return l.hasClass("on")}function o(e){a()!=e&&t(e)}function i(e){l.toggleClass("on",e),l.toggleClass("off",!e)}function s(e){u.css("margin-left",r(e)+"px")}function r(e){return e?0:l.height()-l.width()}var l=$(e),u=$(".switch-toggle-wrapper",l);return{setInitialValue:t,updateValue:o,toggle:n}},onClick:function(e,t){var n=$(e),a=!1;n.mousedown(function(e){1==e.which&&(a=!0,t())}),n.click(function(){return a?void(a=!1):void t()})}},ko.bindingHandlers.dropdown={cssClasses:{dropdown:"dropdown",disabled:"disabled",expanded:"expanded",optionsList:"dropdown-options-list",optionItem:"dropdown-options-item",currentItem:"dropdown-current-item",currentItemText:"dropdown-current-item-text",indicatorHolder:"dropdown-indicator-holder",indicator:"dropdown-indicator"},init:function(e){var t=$(e),n=ko.bindingHandlers.dropdown.cssClasses;t.addClass(n.dropdown);var a=$("<div />").addClass(n.currentItem).appendTo(t);$("<div />").addClass(n.currentItemText).appendTo(a);var o=$("<div />").addClass(n.indicatorHolder).appendTo(a);$("<span />").addClass(n.indicator).appendTo(o),$("<ul />").addClass(n.optionsList).appendTo(t),a.on("click",function(e){t.hasClass(n.disabled)||(a.toggleClass(n.expanded),e.stopPropagation())});var i=function(){a.removeClass(n.expanded)};$("html").bind("click",i),$(window).bind("blur",i),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){$("html").unbind("click",i),$(window).unbind("blur",i)})},update:function(e,t){var n=$(e),a=ko.bindingHandlers.dropdown.cssClasses,o=n.find("ul."+a.optionsList),i=n.find("div."+a.currentItemText),s=t().options,r=t().optionsText,l=t().value,u=t().optionsValue,d=ko.unwrap(l),c=ko.unwrap(t().disable);c?n.toggleClass(a.disabled):n.removeClass(a.disabled),o.empty(),$.each(s,function(e,t){return t[u]==d?void i.text(t[r]):void $("<li />").addClass(a.optionItem).appendTo(o).text(t[r]).on("click",function(){l(t[u]),n.trigger("change")})})}},ko.bindingHandlers.tabs={init:function(e){var t=$(e),n="data-tab-link",a="data-tab",o="active",i=t.find("["+n+"]"),s=t.find("["+a+"]");s.hide(),i.first().addClass(o),s.first().show(),i.each(function(e,r){var l=$(r);l.on("click",function(){var e=l.attr(n),r=t.find("["+a+'="'+e+'"]');i.removeClass(o),l.addClass(o),s.hide(),r.show()})})}},ko.bindingHandlers.localize={init:function(e,t){var n=$(e),a=ko.unwrap(t());n.html(app.localize(a))}}}(),function(e){function t(e){function t(e){e&&r.setUrl(e.url)}function n(){r.isLoading(!1),r.isError(!1)}function a(e,t){r.clear(),r.isLoading(!1),r.errorText(e),r.errorDescription(t),r.isError(!0)}function o(){r.isLoading(!0)}function i(e){r.url(e||"")}function s(){return{url:r.url()}}var r=this;return r.url=ko.observable(""),r.hasLogo=ko.computed(function(){return""!==r.url()}),r.clear=function(){r.url("")},r.isError=ko.observable(!1),r.errorText=ko.observable(""),r.errorDescription=ko.observable(""),r.isLoading=ko.observable(!1),r.setDefaultStatus=n,r.setFailedStatus=a,r.setLoadingStatus=o,r.setUrl=i,r.getData=s,t(e),r}function n(t){function n(e){e&&(u.enableXAPI(e.enabled),e.selectedLrs&&u.selectLrsByName(e.selectedLrs),e.lrs&&u.setCustomLrsSettings(e.lrs),e.allowedVerbs&&u.setStatements(e.allowedVerbs))}function a(){u.advancedSettingsExpanded(!u.advancedSettingsExpanded())}function o(e){ko.utils.arrayForEach(u.lrsOptions,function(e){e.isSelected(!1)}),e.isSelected(!0)}function i(e){ko.utils.arrayForEach(u.lrsOptions,function(t){t.isSelected(t.name===e)})}function s(e){ko.utils.objectForEach(u.statements,function(t,n){n(e.indexOf(t)>-1)})}function r(e){u.lrsUrl(e.uri||""),u.authenticationRequired(e.authenticationRequired||!1),u.lapLogin(e.credentials.username||""),u.lapPassword(e.credentials.password||"")}function l(){var e=[];return ko.utils.objectForEach(u.statements,function(t,n){n()&&e.push(t)}),{enabled:u.enableXAPI(),selectedLrs:u.selectedLrs(),lrs:{uri:u.lrsUrl(),authenticationRequired:u.authenticationRequired(),credentials:{username:u.lapLogin(),password:u.lapPassword()}},allowedVerbs:e}}var u=this;return u.advancedSettingsExpanded=ko.observable(!1),u.enableXAPI=ko.observable(!0),u.lrsOptions=[new e.LrsOption("default",!0),new e.LrsOption("custom")],u.selectedLrs=ko.computed(function(){var e="";return ko.utils.arrayForEach(u.lrsOptions,function(t){t.isSelected()&&(e=t.name)}),e},u),u.customLrsEnabled=ko.computed(function(){return u.enableXAPI()&&u.selectedLrs()!=u.lrsOptions[0].name}),u.lrsUrl=ko.observable(""),u.authenticationRequired=ko.observable(!1),u.lapLogin=ko.observable(),u.lapPassword=ko.observable(),u.credentialsEnabled=ko.computed(function(){return u.customLrsEnabled()&&u.authenticationRequired()}),u.statements={started:ko.observable(!0),stopped:ko.observable(!0),mastered:ko.observable(!0),passed:ko.observable(!0),failed:ko.observable(!0)},u.toggleAdvancedSettings=a,u.selectLrs=o,u.selectLrsByName=i,u.setStatements=s,u.setCustomLrsSettings=r,u.getData=l,n(t),u}function a(e,t){var n=this;return n.name=e,n.isSelected=ko.observable(t===!0),n}function o(t,n){function a(t,n){ko.utils.arrayForEach(t||[],function(t){s(new e.LanguageModel(t.code,e.localize(t.code),t.url))});var a=r(c),o=new e.LanguageModel(d,e.localize(d),a?a.resourcesUrl:null,n?n.customTranslations:null);s(o);var i=n&&n.selected?n.selected:c;u.selectedLanguageCode(i)}function o(){return u.selectedLanguageCode()===d}function i(){var e=r(d);return e?e.getNotMappedTranslations():[]}function s(e){u.languages.push(e)}function r(e){return ko.utils.arrayFirst(u.languages,function(t){return t.code===e})}function l(){var e={};u.selectedLanguageCode()&&(e.selected=u.selectedLanguageCode());var t=i();return t&&!$.isEmptyObject(t)&&(e.customTranslations=t),e}var u=this,d="xx",c="en";u.languages=[];var g=ko.observable(n&&n.selected?n.selected:null);return u.selectedLanguageCode=ko.pureComputed({read:function(){return g()},write:function(e){var t=r(e);if(t){if(t.isLoaded)return void g(e);u.isLanguageLoading(!0),t.load().done(function(){g(e),u.isLanguageLoading(!1)})}}}),u.selectedLanguageTranslations=ko.pureComputed(function(){var e=r(u.selectedLanguageCode());return e?e.getTranslations():null}),u.isLanguageLoading=ko.observable(!1),u.isLanguageEditable=o,u.getCustomTranslations=i,u.getData=l,a(t,n),u}function i(e,t,n,a){function o(e){g=u(e)}function i(){return g}function s(){return d(g)}function r(){return l(c.resourcesUrl).then(function(e){if(p){var t={};$.each(e,function(e,n){t[e]="string"==typeof p[e]?p[e]:n}),c.setTranslations(t)}else c.setTranslations(e);c.isLoaded=!0})}function l(e){return $.ajax({url:e,dataType:"json",contentType:"application/json"})}function u(e){var t=[];return e&&Object.keys(e).forEach(function(n){t.push({key:n,value:e[n]})}),t}function d(e){var t={};return e&&e.forEach(function(e){t[e.key]=e.value}),t}var c=this,g=[],p=a;c.code=e,c.name=t,c.isLoaded=!1,c.load=r,c.resourcesUrl=n,c.setTranslations=o,c.getTranslations=i,c.getNotMappedTranslations=s,a&&c.setTranslations(a)}e.LogoModel=t,e.TrackingDataModel=n,e.LrsOption=a,e.LanguagesModel=o,e.LanguageModel=i}(window.app=window.app||{}),function(e){function t(){var e={apiUrl:o+"/storage/image/upload",maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"],somethingWentWrongMessage:{title:"Something went wrong",description:"Please, try again"},status:{"default":function(){i.logo.setDefaultStatus()},fail:function(e){i.logo.setFailedStatus(e.title,e.description)},loading:function(){i.logo.isLoading(!0)}},button:{enable:function(){this.$input.attr("disabled",!1).closest(".image-upload-button").removeClass("disabled")},disable:function(){this.$input.attr("disabled",!0).closest(".image-upload-button").addClass("disabled")},submit:function(){this.$input[0].form.submit(),this.disable(),e.status.loading()},$input:$("#logoInput")},init:function(){e.button.$input.on("change",e.processFile),e.button.enable()},processFile:function(){if(!this.files)return void e.button.submit();if(0!==this.files.length){var t=this.files[0],n=t.name.split(".").pop().toLowerCase();return-1===$.inArray(n,e.supportedExtensions)?void e.status.fail({title:"Unsupported image format",description:"(Allowed formats: "+e.supportedExtensions.join(", ")+")"}):t.size>1024*e.maxFileSize*1024?void e.status.fail({title:"File is too large",description:"(Max file size: "+e.maxFileSize+"MB)"}):void e.uploadFile(t)}},uploadFile:function(t){e.button.disable(),e.status.loading();var n=new FormData;n.append("file",t),$.ajax({url:e.apiUrl,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(t){e.handleResponse(t)}).fail(function(){e.status.fail(e.somethingWentWrongMessage),e.button.enable()})},handleResponse:function(t){try{if(!t)throw"Response is empty";if("object"!=typeof t&&(t=JSON.parse(t)),!t||!t.success||!t.data)throw"Request is not success";i.logo.setUrl(t.data.url),e.status["default"]()}catch(n){e.status.fail(e.somethingWentWrongMessage)}finally{e.button.enable()}}};return e}var n=null,a=null,o=location.protocol+"//"+location.host,i={trackingData:null,languages:null,logo:null,userHasStarterPlan:ko.observable(!1)};i.getSettingsData=function(){return{logo:i.logo.getData(),xApi:i.trackingData.getData(),languages:i.languages.getData()}},i.getExtraData=function(){return{}},i.saveChanges=function(){var t=i.getSettingsData(),o=i.getExtraData(),s=JSON.stringify(t),r=JSON.stringify(o);(JSON.stringify(n)!==s||JSON.stringify(a)!==r)&&window.egApi.saveSettings(s,r,e.localize("changes are saved"),e.localize("changes are not saved")).done(function(){n=t,a=o})},i.init=function(){var t=window.egApi;return t.init().then(function(){var o=t.getManifest(),s=t.getUser(),r=t.getSettings();s.accessType>0&&i.userHasStarterPlan(!0),i.trackingData=new e.TrackingDataModel(r.xApi),i.languages=new e.LanguagesModel(o.languages,r.languages),i.logo=new e.LogoModel(r.logo),n=i.getSettingsData(),a=i.getExtraData()}).fail(function(){t.sendNotificationToEditor(e.localize("settings are not initialize"),!1)})},i.init().done(function(){$(document).ready(function(){if(ko.applyBindings(i,$(".settings-container")[0]),window.egApi.getUser().accessType>0){var e=new t;e.init()}$(window).on("blur",i.saveChanges)})})}(window.app=window.app||{});