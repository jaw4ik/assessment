!function(t){function e(){var t={apiUrl:i+"/storage/image/upload",maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"],somethingWentWrongMessage:{title:"Something went wrong",description:"Please, try again"},status:{"default":function(){o.logo.setDefaultStatus()},fail:function(t){o.logo.setFailedStatus(t.title,t.description)},loading:function(){o.logo.isLoading(!0)}},button:{enable:function(){this.$input.attr("disabled",!1).closest(".image-upload-button").removeClass("disabled")},disable:function(){this.$input.attr("disabled",!0).closest(".image-upload-button").addClass("disabled")},submit:function(){this.$input[0].form.submit(),this.disable(),t.status.loading()},$input:$("#logoInput")},init:function(){t.button.$input.on("change",t.processFile),t.button.enable()},processFile:function(){if(!this.files)return void t.button.submit();if(0!==this.files.length){var e=this.files[0],n=e.name.split(".").pop().toLowerCase();return-1===$.inArray(n,t.supportedExtensions)?void t.status.fail({title:"Unsupported image format",description:"(Allowed formats: "+t.supportedExtensions.join(", ")+")"}):e.size>1024*t.maxFileSize*1024?void t.status.fail({title:"File is too large",description:"(Max file size: "+t.maxFileSize+"MB)"}):void t.uploadFile(e)}},uploadFile:function(e){t.button.disable(),t.status.loading();var n=new FormData;n.append("file",e),$.ajax({url:t.apiUrl,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(e){t.handleResponse(e)}).fail(function(){t.status.fail(t.somethingWentWrongMessage),t.button.enable()})},handleResponse:function(e){try{if(!e)throw"Response is empty";if("object"!=typeof e&&(e=JSON.parse(e)),!e||!e.success||!e.data)throw"Request is not success";o.logo.setUrl(e.data.url),t.status["default"]()}catch(n){t.status.fail(t.somethingWentWrongMessage)}finally{t.button.enable()}}};return t}var n=null,a=null,i=location.protocol+"//"+location.host,o={trackingData:null,languages:null,logo:null,userHasStarterPlan:ko.observable(!1)};o.getSettingsData=function(){return{logo:o.logo.getData(),xApi:o.trackingData.getData(),languages:o.languages.getData()}},o.getExtraData=function(){return{}},o.saveChanges=function(){var e=o.getSettingsData(),i=o.getExtraData(),s=JSON.stringify(e),l=JSON.stringify(i);(JSON.stringify(n)!==s||JSON.stringify(a)!==l)&&window.egApi.saveSettings(s,l,t.localize("changes are saved"),t.localize("changes are not saved")).done(function(){n=e,a=i})},o.init=function(){var e=window.egApi;return e.init().then(function(){var i=e.getManifest(),s=e.getUser(),l=e.getSettings();s.accessType>0&&o.userHasStarterPlan(!0),o.trackingData=new t.TrackingDataModel(l.xApi),o.languages=new t.LanguagesModel(i.languages,l.languages),o.logo=new t.LogoModel(l.logo),n=o.getSettingsData(),a=o.getExtraData()}).fail(function(){e.sendNotificationToEditor(t.localize("settings are not initialize"),!1)})},o.init().done(function(){$(document).ready(function(){if(ko.applyBindings(o,$(".settings-container")[0]),window.egApi.getUser().accessType>0){var t=new e;t.init()}$(window).on("blur",o.saveChanges)})})}(window.app=window.app||{});