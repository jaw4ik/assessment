function getURLParameter(e){return decodeURI((RegExp(e+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}$(function(){function e(){if(!this.files)return void b.submit();if(0!=this.files.length){var e=this.files[0],a=e.name.split(".").pop().toLowerCase();return-1===$.inArray(a,p)?void f.fail({title:"Unsupported image format",description:"(Supported formats: "+p.join(", ")+")"}):e.size>1024*u*1024?void f.fail({title:"File is too large",description:"(Max file size: "+u+"MB)"}):void t(e)}}function t(e){b.disable(),f.loading();var t=new FormData;t.append("file",e),$.ajax({url:c,type:"POST",data:t,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(e){n(e)}).fail(function(){f.fail(g),b.enable()})}function a(){$("#logoForm").attr("action",c),$("#logoFrame").on("readystatechange",function(){if("complete"==this.readyState)try{var e=this.contentDocument.body.innerHTML;n(e)}catch(t){f.fail(g),b.enable()}})}function n(e){try{if(!e)throw"Response is empty";if("object"!=typeof e&&(e=JSON.parse(e)),!e||!e.success||!e.data)throw"Request is not success";d.logo.url(e.data.url),f.default()}catch(t){f.fail(g)}finally{b.enable()}}var o=getURLParameter("courseId"),i=getURLParameter("templateId"),r=location.protocol+"//"+location.host,s=r+"/api/course/"+o+"/template/"+i,l=1,d={trackingData:function(){var e={};return e.enableXAPI=ko.observable(!0),e.lrsOptions=[{key:"default",text:"easygenerator (recommended)"},{key:"custom",text:"custom LRS"}],e.selectedLrs=ko.observable(e.lrsOptions[0].key),ko.utils.arrayMap(e.lrsOptions,function(t){return t.isSelected=ko.computed({read:function(){return e.selectedLrs()==t.key},write:function(){}}),t.select=function(){ko.utils.arrayForEach(e.lrsOptions,function(e){e.isSelected(!1)}),t.isSelected(!0),e.selectedLrs(t.key)},t}),e.customLrsEnabled=ko.computed(function(){return e.enableXAPI()&&e.selectedLrs()!=e.lrsOptions[0].key}),e.lrsUrl=ko.observable(""),e.authenticationRequired=ko.observable(!1),e.lapLogin=ko.observable(),e.lapPassword=ko.observable(),e.credentialsEnabled=ko.computed(function(){return e.customLrsEnabled()&&e.authenticationRequired()}),e.statements={started:ko.observable(!0),stopped:ko.observable(!0),mastered:ko.observable(!0),passed:ko.observable(!0),failed:ko.observable(!0)},e}(),isSaved:ko.observable(!1),isFailed:ko.observable(!1),advancedSettingsExpanded:ko.observable(!1),toggleAdvancedSettings:function(){this.advancedSettingsExpanded(!this.advancedSettingsExpanded())},logo:function(){var e={};return e.url=ko.observable("").extend({throttle:300}),e.hasLogo=ko.computed(function(){return""!=e.url()}),e.clear=function(){e.url("")},e.isError=ko.observable(!1),e.errorText=ko.observable(""),e.errorDescription=ko.observable(""),e.isLoading=ko.observable(!1),e}(),hasStarterPlan:ko.observable(!0)};d.saveChanges=function(){var e={logo:{url:d.hasStarterPlan()?d.logo.url():""},xApi:{enabled:d.trackingData.enableXAPI(),selectedLrs:d.trackingData.selectedLrs(),lrs:{uri:d.trackingData.lrsUrl(),authenticationRequired:d.trackingData.authenticationRequired(),credentials:{username:d.trackingData.lapLogin(),password:d.trackingData.lapPassword()}},allowedVerbs:$.map(d.trackingData.statements,function(e,t){return e()?t:void 0})}};d.isFailed(!1),d.isSaved(!1),$.post(s,{settings:JSON.stringify(e)}).done(function(){d.isSaved(!0)}).fail(function(){d.isFailed(!0)})},$.ajax({cache:!1,url:s,dataType:"json",success:function(e){var t,a={logo:{},xApi:{enabled:!0,selectedLrs:"default",lrs:{credentials:{}}}};try{t=JSON.parse(e.settings)||a}catch(n){t=a}d.trackingData.enableXAPI(t.xApi.enabled||!1);var o=t.xApi.enabled?"custom":"default";d.trackingData.selectedLrs(t.xApi.selectedLrs||o),d.trackingData.lrsUrl(t.xApi.lrs.uri||""),d.trackingData.authenticationRequired(t.xApi.lrs.authenticationRequired||!1),d.trackingData.lapLogin(t.xApi.lrs.credentials.username||""),d.trackingData.lapPassword(t.xApi.lrs.credentials.password||""),t.xApi.allowedVerbs&&$.each(d.trackingData.statements,function(e,a){a($.inArray(e,t.xApi.allowedVerbs)>-1)}),d.logo.url(t.logo.url||"")}}),$.ajax({url:r+"/api/identify",type:"POST",contentType:"application/json",dataType:"json",success:function(e){if(e.hasOwnProperty("subscription")&&e.subscription.hasOwnProperty("accessType")){var t=e.subscription.accessType>=l&&new Date(e.subscription.expirationDate)>=new Date;d.hasStarterPlan(t)}else d.hasStarterPlan(!1)},error:function(){d.hasStarterPlan(!1)}}),ko.bindingHandlers.fadeVisible={init:function(e,t){var a=t();$(e).toggle(ko.unwrap(a))},update:function(e,t){var a=t();ko.unwrap(a)?$(e).fadeIn():$(e).fadeOut()}},ko.bindingHandlers.number={init:function(e){var t=$(e),a=100;t.on("keydown",function(e){var t=e.charCode||e.keyCode||0;return 8==t||9==t||46==t||t>=37&&40>=t||t>=48&&57>=t||t>=96&&105>=t}),t.on("keyup",function(){$(this).val()>a&&$(this).val(a)})}},ko.bindingHandlers.disableDragNDrop={init:function(e){$(e).on("dragstart",function(e){e.preventDefault()})}},ko.bindingHandlers.switchToggle={init:function(e,t){var a=ko.bindingHandlers.switchToggle,n=a.viewModel(e,t),o=ko.unwrap(t().value());n.setInitialValue(o),a.onClick(e,function(){n.toggle();var e=ko.unwrap(t().value());t().value(!e)})},update:function(e,t){var a=ko.bindingHandlers.switchToggle.viewModel(e,t),n=ko.unwrap(t().value());a.updateValue(n)},viewModel:function(e){function t(e){i(e),r(e)}function a(){var e=n();i(!e),d.stop().animate({marginLeft:s(!e)},250)}function n(){return l.hasClass("on")}function o(e){n()!=e&&t(e)}function i(e){l.toggleClass("on",e),l.toggleClass("off",!e)}function r(e){d.css("margin-left",s(e)+"px")}function s(e){return e?0:l.height()-l.width()}var l=$(e),d=$(".switch-toggle-wrapper",l);return{setInitialValue:t,updateValue:o,toggle:a}},onClick:function(e,t){var a=$(e),n=!1;a.mousedown(function(e){1==e.which&&(n=!0,t())}),a.click(function(){return n?void(n=!1):void t()})}},ko.bindingHandlers.dropdown={cssClasses:{dropdown:"dropdown",disabled:"disabled",expanded:"expanded",optionsList:"dropdown-options-list",optionItem:"dropdown-options-item",currentItem:"dropdown-current-item",currentItemText:"dropdown-current-item-text",indicatorHolder:"dropdown-indicator-holder",indicator:"dropdown-indicator"},init:function(e){var t=$(e),a=ko.bindingHandlers.dropdown.cssClasses;t.addClass(a.dropdown);var n=$("<div />").addClass(a.currentItem).appendTo(t);$("<div />").addClass(a.currentItemText).appendTo(n);var o=$("<div />").addClass(a.indicatorHolder).appendTo(n);$("<span />").addClass(a.indicator).appendTo(o),$("<ul />").addClass(a.optionsList).appendTo(t),n.on("click",function(e){t.hasClass(a.disabled)||(n.toggleClass(a.expanded),e.stopPropagation())});var i=function(){n.removeClass(a.expanded)};$("html").bind("click",i),$(window).bind("blur",i),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){$("html").unbind("click",i),$(window).unbind("blur",i)})},update:function(e,t){var a=$(e),n=ko.bindingHandlers.dropdown.cssClasses,o=a.find("ul."+n.optionsList),i=a.find("div."+n.currentItemText),r=t().options,s=t().optionsText,l=t().value,d=t().optionsValue,c=ko.unwrap(l),u=ko.unwrap(t().disable);u?a.toggleClass(n.disabled):a.removeClass(n.disabled),o.empty(),$.each(r,function(e,t){return t[d]==c?void i.text(t[s]):void $("<li />").addClass(n.optionItem).appendTo(o).text(t[s]).on("click",function(){l(t[d]),a.trigger("change")})})}},ko.bindingHandlers.tabs={init:function(e){var t=$(e),a="data-tab-link",n="data-tab",o="active",i=t.find("["+a+"]"),r=t.find("["+n+"]");r.hide(),i.first().addClass(o),r.first().show(),i.each(function(e,s){var l=$(s);l.on("click",function(){var e=l.attr(a),s=t.find("["+n+'="'+e+'"]');i.removeClass(o),l.addClass(o),r.hide(),s.show()})})}},ko.applyBindings(d,$("#settingsForm")[0]);var c=r+"/storage/image/upload",u=10,p=["jpeg","jpg","png","bmp","gif"],g={title:"Something went wrong",description:"Please, try again"},f={"default":function(){d.logo.isLoading(!1),d.logo.isError(!1)},fail:function(e){d.logo.clear(),d.logo.isLoading(!1),d.logo.errorText(e.title),d.logo.errorDescription(e.description),d.logo.isError(!0)},loading:function(){d.logo.isLoading(!0)}},b={enable:function(){this.$input.attr("disabled",!1).closest(".image-upload-button").removeClass("disabled")},disable:function(){this.$input.attr("disabled",!0).closest(".image-upload-button").addClass("disabled")},submit:function(){this.$input[0].form.submit(),this.disable(),f.loading()},$input:function(){return $("#logoInput").on("change",e)}()};window.top.navigator.userAgent.match(/MSIE 9/i)&&a()});