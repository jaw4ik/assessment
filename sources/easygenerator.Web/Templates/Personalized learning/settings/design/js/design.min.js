!function(e){e.localize=function(e){return o[e]};var o={"changes are saved":"All changes are saved","changes are not saved":"Changes have NOT been saved. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists.","settings are not initialize":"Template settings are not initialized. Please reload the page and change the settings again. Contact support@easygenerator.com if problem persists.","graphical customization":"Graphical customization","customize your course":"Customize your course","look and feel of the course":"Change the look and feel of the course","custom course logo":"Custom course logo:",or:"or","upload logo image":"Upload logo image","logo hint":"- recommended size 300x50 px, allowed formats: jpeg, jpg, png, bmp, gif","clear logo":"Clear logo","upgrade account hint":'You have to <a target="_blank" href="/account/upgrade">upgrade your account</a> in order to set custom course logo',"logo update":"Change","logo remove":"Clear","background change":"Change background:","background update":"Change background","background remove":"Clear background","background original":"Original","background repeat":"Repeat","background fullscreen":"Fullscreen","background upgrade account hint":'You have to <a target="_blank" href="/account/upgrade">upgrade your account</a> in order to set custom course background',"no-settings-message":"There is no layout settings yet."}}(window.app=window.app||{}),function(e){function o(e){var o=e.name.split(".").pop().toLowerCase();return-1===$.inArray(o,c.supportedExtensions)?{title:"Unsupported image format",description:"(Allowed formats: "+c.supportedExtensions.join(", ")+")"}:e.size>1024*c.maxFileSize*1024?{title:"File is too large",description:"(Max file size: "+c.maxFileSize+"MB)"}:!0}function n(e){var o=RegExp(e+"=(.+?)(&|$)").exec(location.search)||null;return null===o?null:decodeURI(o[1])}function r(){var e=$.Deferred(),o=window.parent.localStorageProvider;return o||e.resolve(localStorage["token.settings"]),o.getItem("token.settings").then(function(o){e.resolve(o)}).fail(function(){e.resolve("")}),e.promise()}function t(){var e=$.Deferred();return i.Authorization?e.resolve():r().then(function(o){i.Authorization+="Bearer "+(n("token")||o),e.resolve()}),e.promise()}var a=location.protocol+"//"+location.host+"/storage/image/upload",i={Authorization:""},s={title:"Something went wrong",description:"Please, try again"},c={maxFileSize:10,supportedExtensions:["jpeg","jpg","png","bmp","gif"]};e.upload=function(e){var n=$.Deferred(),r=$("<form>").hide().attr("method","post").attr("enctype","multipart/form-data").insertAfter("body"),u=$("<input>").attr("accept",c.supportedExtensions.map(function(e){return"."+e}).join(", ")).attr("type","file").attr("name","file").on("change",function(){e&&e();var r=this.files[0],c=o(r);if(c!==!0)return void n.reject(c);var u=new FormData;u.append("file",r),t().then(function(){$.ajax({url:a,type:"POST",headers:i,data:u,contentType:!1,processData:!1}).done(function(e){try{var o=JSON.parse(e);o&&o.success&&o.data&&o.data.url?n.resolve(o.data.url):n.reject(s)}catch(r){n.reject(s)}}).fail(function(){n.reject(s)})})}).appendTo(r);return u.click(),n.promise()}}(window.app=window.app||{}),function(){ko.bindingHandlers.fadeVisible={init:function(e,o){var n=o();$(e).toggle(ko.unwrap(n))},update:function(e,o){var n=o();ko.unwrap(n)?$(e).fadeIn():$(e).fadeOut()}},ko.bindingHandlers.localize={init:function(e,o){var n=$(e),r=ko.unwrap(o());n.html(app.localize(r))}},ko.bindingHandlers.background={init:function(e){$(e).css("background-size","cover").css("background-position","center").css("background-repeat","no-repeat")},update:function(e,o){var n=ko.unwrap(o());if($(e).css("background-image","none"),n){var r=new Image;r.onload=function(){$(e).css("background-image","url("+n+")")},r.src=n}}}}(),function(e){function o(e){this.hasStarterPlan=e&&e.accessType>0}function n(o,n){function r(e){e&&l.setUrl(e.url)}function t(){l.isLoading()||e.upload(function(){s()}).done(function(e){c(e),a(),n()}).fail(function(e){i(e.title,e.description),n()})}function a(){l.isLoading(!1),l.isError(!1)}function i(e,o){l.clear(),l.isLoading(!1),l.isError(!0),l.errorText(e),l.errorDescription(o)}function s(){l.clear(),l.isLoading(!0)}function c(e){l.url(e||"")}function u(){return{url:l.url()}}var l=this;return l.url=ko.observable(""),l.clear=function(){l.url(""),n()},l.isError=ko.observable(!1),l.errorText=ko.observable(""),l.errorDescription=ko.observable(""),l.isLoading=ko.observable(!1),l.hasLogo=ko.computed(function(){return l.isError(!1),""!==l.url()}),l.setUrl=c,l.getData=u,l.upload=t,r(o),l}function r(o,n){var r=$.extend(!0,{image:{src:null,type:"fullscreen"}},o),t=this;t.image=ko.observable(r.image.src),t.image.isUploading=ko.observable(!1),t.image.isEmpty=ko.computed(function(){return!(t.image()&&t.image().length>0)}),t.type=ko.observable(r.image.type),t.type.fullscreen=function(){t.type("fullscreen"),n()},t.type.repeat=function(){t.type("repeat"),n()},t.type.original=function(){t.type("original"),n()},t.errorTitle=ko.observable(),t.errorDescription=ko.observable(),t.hasError=ko.observable(!1),t.changeImage=function(){t.image.isUploading()||e.upload(function(){t.image.isUploading(!0),t.hasError(!1),t.errorTitle(void 0),t.errorDescription(void 0)}).done(function(e){t.image(e)}).fail(function(e){t.image(void 0),t.hasError(!0),t.errorTitle(e.title),t.errorDescription(e.description)}).always(function(){t.image.isUploading(!1),n()})},t.clearImage=function(){t.image(null),n()},t.getData=function(){return{image:{src:t.image(),type:t.type()}}}}e.UserAccessModel=o,e.LogoModel=n,e.BackgroundModel=r}(window.app=window.app||{}),function(e){var o=null,n=null,r={isError:ko.observable(!1),userAccess:null,logo:null};r.getCurrentSettingsData=function(e){return $.extend({},e||o,{logo:r.logo.getData(),background:r.background.getData()})},r.getCurrentExtraData=function(){return{}},r.saveChanges=function(){var t=r.getCurrentSettingsData(),a=r.getCurrentExtraData(),i=JSON.stringify(t),s=JSON.stringify(a);(JSON.stringify(o)!==i||JSON.stringify(n)!==s)&&window.egApi.saveSettings(i,s,e.localize("changes are saved"),e.localize("changes are not saved")).done(function(){o=t,n=a})},r.init=function(){var t=window.egApi;return t.init().then(function(){var a=t.getUser(),i=t.getSettings();r.userAccess=new e.UserAccessModel(a),r.logo=new e.LogoModel(i.logo,r.saveChanges),r.background=new e.BackgroundModel(i.background,r.saveChanges),o=r.getCurrentSettingsData(i),n=r.getCurrentExtraData()}).fail(function(){r.isError(!0)})},r.init().always(function(){$(document).ready(function(){ko.applyBindings(r,$(".settings-container")[0]),$(window).on("blur",r.saveChanges)})})}(window.app=window.app||{});