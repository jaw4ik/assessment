!function(){function t(){var t=$.ajax({url:T,headers:v,cache:!1,type:"POST",contentType:"application/json",dataType:"json"}),e=$.ajax({url:j,headers:v,cache:!1,contentType:"application/json",dataType:"json"}),n=$.ajax({url:S,headers:v,cache:!1,contentType:"application/json",dataType:"json"});return $.when(n,t,e).done(function(t,e,n){y.manifest=s(t[0]),y.user=o(e[0]),y.settings=r(n[0]),y.isInited=!0})}function e(){if(!y.isInited)throw"Sorry, but you've tried to use api before it was initialized"}function n(){return e(),y.manifest}function i(){return e(),y.user}function a(){return e(),y.settings}function s(t){if(t&&t.languages&&t.languages.length>0)for(var e=0;e<t.languages.length;e++)t.languages[e].url=w+t.languages[e].url;return t}function o(t){t=t.data;var e={accessType:0},n=1;return t.subscription&&t.subscription.accessType&&t.subscription.accessType>=n&&new Date(t.subscription.expirationDate)>=new Date&&(e.accessType=t.subscription.accessType),e}function r(t){var e;return e=t.settings&&t.settings.length>0?JSON.parse(t.settings):{xApi:{enabled:!0,selectedLrs:"default",lrs:{credentials:{}}},masteryScore:{}}}function c(t){var e=RegExp(t+"=(.+?)(&|$)").exec(location.search)||null;return null===e?null:decodeURI(e[1])}function u(t,e,n,i){l();var a={settings:t,extraSettings:e},s={url:j,type:"POST",headers:v,cache:!1,dataType:"json",data:a};return $.ajax(s).done(function(){g(n,!0)}).fail(function(){g(i,!1)}).always(function(){p()})}function l(){d({type:"freeze-editor"})}function p(){d({type:"unfreeze-editor"})}function g(t,e){d({type:"notification",data:{success:e,message:t}})}function f(){d({type:"show-settings"})}function d(t){var e=window.top;e.postMessage(t,"*")}var y={isInited:!1},h=location.protocol+"//"+location.host,T=h+"/auth/identity",j=h+"/api/course/"+c("courseId")+"/template/"+c("templateId"),w=location.toString().substring(0,location.toString().indexOf("/settings/"))+"/",S=w+"manifest.json",v={Authorization:"Bearer "+(c("token")||localStorage["token.settings"])};window.egApi={init:t,getManifest:n,getUser:i,getSettings:a,saveSettings:u,sendNotificationToEditor:g,showSettings:f}}();